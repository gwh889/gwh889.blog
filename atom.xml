<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>个人学习博客</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-10-10T09:15:51.404Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>GWH</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>小程序开发以及遇到的问题</title>
    <link href="http://example.com/2022/10/10/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/"/>
    <id>http://example.com/2022/10/10/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/</id>
    <published>2022-10-10T09:06:16.132Z</published>
    <updated>2022-10-10T09:15:51.404Z</updated>
    
    <content type="html"><![CDATA[<p>小程序开发</p><h3 id="一、申请小程序账号"><a href="#一、申请小程序账号" class="headerlink" title="一、申请小程序账号"></a>一、申请小程序账号</h3><p>一个邮箱只能申请一个小程序账号，对应一个小程序项目，个人最多可以申请5个，企业最多可以申请50个</p><h3 id="二、项目开发"><a href="#二、项目开发" class="headerlink" title="二、项目开发"></a>二、项目开发</h3><p>1.新建小程序项目，appid填写新申请的小程序账号中的，不使用云开发</p><p>2.默认新建的项目下没有package.json文件，所以需要使用npm init初始化一直回车，会在根目录下创建</p><p>3.使用npm命令进行安装第三方插件（配置要看相应的官方文档）</p><p>4.点击详情=&gt;本地设置=&gt;使用npm包，点击顶部菜单栏 工具=&gt;构建npm，然后引入组件就可以使用了</p><p><strong>注意</strong>： 这个模块是必须的，每次安装npm模块都需要构建npm</p><h3 id="单位：-（iphone）"><a href="#单位：-（iphone）" class="headerlink" title="单位： （iphone）"></a>单位： （iphone）</h3><p>1.物理像素(屏幕分辨率）：  像素点 px    750* 1334</p><p>2.设备独立像素（css像素）：  虚拟像素                     375* 667</p><p>3.dpr：  设备像素比=物理像素/设备独立像素  iPhone6的dpr是2</p><p>4.ppI：  一英寸显示屏上的像素点个数      5.5英寸的设备是对角线的长度   163</p><p>小程序适配： </p><p>常用rem（根元素字体大小）、viewport（布局视图等于视觉视图，本身布局视图（750）&gt;视觉视图（375））</p><p>iphone6：  1rpx=1物理像素=0.5px   1rpx=目标设备宽度/750*px   底层已经做了viewport适配的处理</p><p>视网膜屏幕：  iphone6的dpr是2是人类肉眼分辨的极限</p><h3 id="项目开发中遇到的问题"><a href="#项目开发中遇到的问题" class="headerlink" title="项目开发中遇到的问题"></a>项目开发中遇到的问题</h3><p>1.图表问题</p><p>（1）小程序利用ec-canvas组件使用echarts图表示，真机调试会报错，此时为ec-canvas标签添加force-use-old-canvas=”true”，使用后画面可能会失真，上线去掉即可（正式上线不会有这个问题）</p><p>（2）图表可能存在加载不出来或者不随页面滚动的问题，使用force-use-old-canvas=”true”图表会跟着页面移动，但是页面会失真，使用旧的canvas</p><p>2.小程序van  dialog使用报错   未找到 van-dialog 节点，请确认 selector 及 context 是否正确</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dialog.alert(&#123;</span><br><span class="line">    context: <span class="built_in">this</span>,<span class="comment">//不添加这个会报如上错误</span></span><br><span class="line">    message: <span class="string">&#x27;弹窗内容&#x27;</span>,</span><br><span class="line">    &#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// on close</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>3.获取上一个通过navigator跳转的页面路由</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pages = getCurrentPages();</span><br><span class="line"><span class="keyword">let</span> currPage = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (pages.length) &#123;</span><br><span class="line">  currPage = pages[pages.length - <span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> route = currPage.route</span><br></pre></td></tr></table></figure><p>4.页面中传过来的参数都在onload周期函数中的options</p><p>5.全局配置中tabBar中的页面，不能把通过navigateTo/redirectTo跳转，要使用switchTab跳转</p><p>6.在vant标签中使用iconfont，例如在输入框左侧添加图标</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">password</span> <span class="attr">class</span>=<span class="string">&quot;input_detail&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;password&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;fontSize: 28rpx;fontFamily: PingFang SC;fontWeight: 500;&quot;</span>&gt;</span></span><br><span class="line">    //特殊处理</span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">class</span>=<span class="string">&quot;iconfont&quot;</span> <span class="attr">class-prefix</span>=<span class="string">&#x27;iconicon&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;mima&#x27;</span> <span class="attr">slot</span>=<span class="string">&quot;left-icon&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br></pre></td></tr></table></figure><p>7.小程序表单必填项判断，如果自己写会较复杂，所以可以使用别人封装好的WxValidate.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WxValidate <span class="keyword">from</span> <span class="string">&quot;../../../../utils/WxValidate&quot;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 校验必填项</span></span><br><span class="line"><span class="function"><span class="title">initValidate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> rules = &#123;</span><br><span class="line">    ztdypMachineSpeed: &#123;</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">      number: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    fileList: &#123;</span><br><span class="line">      required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> message = &#123;</span><br><span class="line">    ztdypMachineSpeed: &#123;</span><br><span class="line">      required: <span class="string">&#x27;请输入车速&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    fileList: &#123;</span><br><span class="line">      required: <span class="string">&#x27;请上传图片&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//实例化当前的验证规则和提示消息</span></span><br><span class="line">  <span class="built_in">this</span>.WxValidate = <span class="keyword">new</span> WxValidate(rules, message);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//在onload函数中调用initValidate函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">onload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.initValidate()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//在提交接口的函数中进行校验</span></span><br><span class="line"><span class="comment">//validateParams是要校验的字段，对象json格式</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">this</span>.WxValidate.checkForm(validateParams)) &#123;</span><br><span class="line">      <span class="keyword">const</span> error = <span class="built_in">this</span>.WxValidate.errorList[<span class="number">0</span>]</span><br><span class="line">      Toast(error.msg);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>8.小程序使用formData格式上传文件，由于小程序本身没有formData对象，所以需要引入封装好的formData.js，还要引用mimeMap.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">formData.append(<span class="string">&quot;contractNo&quot;</span>, <span class="built_in">this</span>.properties.options.contractNo);<span class="comment">//键值对json</span></span><br><span class="line">formData.appendFile(<span class="string">&quot;yudingImg&quot;</span> + (i + <span class="number">1</span>), <span class="built_in">this</span>.data.fileList[i].url.replace(getApp().baseUrl, <span class="string">&#x27;&#x27;</span>)); <span class="comment">//文件</span></span><br><span class="line">wx.request(&#123;</span><br><span class="line">    url: getApp().baseUrl + <span class="string">&#x27;/dtsum/zongtong/dyeing/DyeingController/yuDingSubmit&#x27;</span>,</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    header: &#123;</span><br><span class="line">      Cookie: wx.getStorageSync(<span class="string">&#x27;sessionid&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;content-type&#x27;</span>: data.contentType  <span class="comment">//传递类型</span></span><br><span class="line">    &#125;,</span><br><span class="line">    data: data.buffer, <span class="comment">//固定格式</span></span><br><span class="line">    success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">fail</span>(<span class="params">err</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果是Web端使用axios发送请求时，可以使用transformRequest发送formData格式，该方法只适用于post、put和patch这几种请求</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">    roleName: this.formCustom.roleName,</span><br><span class="line">    cardType: this.formCustom.cardType, // 2019.12.19修改 保存角色时添加是否具有平板刷卡权限</span><br><span class="line">    roleDescribe: this.formCustom.des,</span><br><span class="line">    authorityList: this.authorityLists + &quot;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  transformRequest: [</span><br><span class="line">      data = Qs.stringify(data, &#123; arrayFormat: &quot;repeat&quot; &#125;);</span><br><span class="line">      return data;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><p>9.小程序上传图片会生成一个虚拟地址，如果要用formData解析（readFileSync只能读取本地路径），提交接口必须传递这个本地的虚拟地址，如果有保存草稿功能，下次进来可以看到上次上传的图片，并可以直接提交，需要后端也返回这个虚拟的本地地址</p><p>10.小程序中获取dom节点的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.selectComponent(<span class="string">&quot;#list&quot;</span>)</span><br></pre></td></tr></table></figure><p>11.vant中toast组件中不能设置节点，要在组件所在的页面中写<van-toast id="van-toast" /><br>12.双向绑定的局限性： model: value只限于普通键值对，若是对象里的键值对则无效</p><p>13.使用apply改变指向null，如…展开运算符</p><p>14.小程序原生组件textarea和vant中弹出层Popup一起使用，textarea会漂浮在Popup上，可能是因为原生组件的原因，或者是本身的bug，解决办法是在Popup弹出的时候暂时性将textarea隐藏</p><p>15.上传文件：  本地调试时上传的文件应该是放到微信的云服务器上，所以会生成一个虚拟地址<a href="http://temp/+%E6%96%87%E4%BB%B6%E5%90%8D%EF%BC%8C%E8%AF%BB%E5%8F%96%E4%B8%8E%E4%B8%8A%E4%BC%A0%E9%83%BD%E7%94%A8%E8%BF%99%E4%B8%AA%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E6%B2%A1%E9%97%AE%E9%A2%98%E3%80%82">http://temp/+文件名，读取与上传都用这个虚拟地址没问题。</a></p><p>但如果是正式环境，接口使用https，在手机上上传图片的地址则不能使用<a href="http://temp/+%E6%96%87%E4%BB%B6%E5%90%8D">http://temp/+文件名</a> 这个虚拟地址，上传图片的地址应该是wxfile://后加url，读取读片就用上传到服务器的地址（web端的话应该是可以使用虚拟的那个）</p><p>16.使用第三方组件库的组件最好都放在代码最下方，否则会出现不必要的bug（有的机型），例如：  van-Popup弹出层中的按钮，在苹果手机上就会和页面中的按钮重叠，导致层级错乱</p><p>17.微信小程序中背景图不能使用本地图片，解决办法： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.使用网络图片</span><br><span class="line">2.Base64编码</span><br><span class="line">3.使用image标签，设置z-index</span><br></pre></td></tr></table></figure><p>18.监听用户滑动页面事件</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onPageScroll-Object-object">https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onPageScroll-Object-object</a></p><p>在所需要的页面定义onPageScroll方法，用于页面滑动到某一位置进行不同的样式展示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听某元素滚动的位置</span></span><br><span class="line">  <span class="function"><span class="title">onPageScroll</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> query = wx.createSelectorQuery()</span><br><span class="line">    query.select(<span class="string">&#x27;#dyeingFinshingList&#x27;</span>).boundingClientRect(<span class="function">(<span class="params">rect</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> top = rect.top</span><br><span class="line">      <span class="keyword">if</span> (top &lt;= <span class="number">115</span>) &#123;  <span class="comment">//临界值，根据自己的需求来调整</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">          transparent: <span class="literal">false</span>,</span><br><span class="line">          filterFixed: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">          transparent: <span class="literal">true</span>,</span><br><span class="line">          filterFixed: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).exec()</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>19.父子组件传值</p><p>父组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dyeingFinshingList</span> <span class="attr">dyeingStatus</span>=<span class="string">&quot;&#123;&#123;dyeingStatus&#125;&#125;&quot;</span> <span class="attr">orderDeliveryDate</span>=<span class="string">&quot;&#123;&#123;orderDeliveryDate&#125;&#125;&quot;</span> <span class="attr">searchType</span>=<span class="string">&quot;&#123;&#123;searchType&#125;&#125;&quot;</span> <span class="attr">searchText</span>=<span class="string">&quot;&#123;&#123;searchText&#125;&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dyeingFinshingList&quot;</span> <span class="attr">bind:roll</span>=<span class="string">&quot;scroll&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dyeingFinshingList</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scroll(e)&#123;</span><br><span class="line">  if(e.detail.detail.scrollTop&gt;100)&#123;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      transparent: false,</span><br><span class="line">      filterFixed: true,</span><br><span class="line">      searchBtnShow:false</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      transparent: true,</span><br><span class="line">      filterFixed: false,</span><br><span class="line">      searchBtnShow:true</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件改变子组件中的值</span></span><br><span class="line"><span class="built_in">this</span>.selectComponent(<span class="string">&#x27;#dyeingFinshingList&#x27;</span>).properties.dyeingStatus=<span class="number">1</span>;</span><br><span class="line"><span class="built_in">this</span>.selectComponent(<span class="string">&#x27;#dyeingFinshingList&#x27;</span>).show(); <span class="comment">//调用子组件的show方法</span></span><br></pre></td></tr></table></figure><p>子组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">properties: &#123; <span class="comment">//接收父组件传递的参数</span></span><br><span class="line">    dyeingStatus: &#123;</span><br><span class="line">      type: <span class="string">&quot;Object&quot;</span>,</span><br><span class="line">      value: <span class="literal">null</span>,</span><br><span class="line">      observer: <span class="string">&#x27;getTableDataList&#x27;</span>  <span class="comment">//该值发生变化时会调用该getTableDataList方法</span></span><br><span class="line">    &#125;,</span><br><span class="line">    orderDeliveryDate: &#123;</span><br><span class="line">      type: <span class="string">&quot;Object&quot;</span>,</span><br><span class="line">      value: <span class="literal">null</span>,</span><br><span class="line">      observer: <span class="string">&#x27;getTableDataList&#x27;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    searchType: &#123;</span><br><span class="line">      type: <span class="string">&quot;Object&quot;</span>,</span><br><span class="line">      value: <span class="literal">null</span>,</span><br><span class="line">      observer: <span class="string">&#x27;getTableDataList&#x27;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    searchText: &#123;</span><br><span class="line">      type: <span class="string">&quot;Object&quot;</span>,</span><br><span class="line">      value: <span class="literal">null</span>,</span><br><span class="line">      observer: <span class="string">&#x27;getTableDataList&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">methods:&#123;</span><br><span class="line">    <span class="comment">//子组件触发该事件时，同时调用父组件绑定的roll方法</span></span><br><span class="line">    <span class="function"><span class="title">scroll</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;roll&#x27;</span>,e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>20.搜索的历史纪录</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击染厂添加历史记录</span></span><br><span class="line"> <span class="function"><span class="title">clickFactory</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> searchRecord = <span class="built_in">this</span>.data.searchRecord;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; searchRecord.length; i++) &#123;</span><br><span class="line">     <span class="comment">//已有记录则不添加</span></span><br><span class="line">     <span class="keyword">if</span> (e.currentTarget.dataset.message == searchRecord[i]) &#123;</span><br><span class="line">       wx.navigateTo(&#123;</span><br><span class="line">         url: <span class="string">&#x27;/pages/dyeingFinishing/dyeingFinishingSearch/dyeingFinishingSearch?dyeingStatus=10&#x27;</span> + <span class="string">&#x27;&amp;orderDeliveryDate=1&#x27;</span> + <span class="string">&#x27;&amp;searchType=2&#x27;</span>+<span class="string">&#x27;&amp;factory=&#x27;</span>+e.currentTarget.dataset.message</span><br><span class="line">       &#125;)</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">     &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (searchRecord.length &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">     searchRecord.pop() <span class="comment">// 删除最早的一条记录</span></span><br><span class="line">     searchRecord.unshift(e.currentTarget.dataset.message)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     searchRecord.unshift(e.currentTarget.dataset.message)</span><br><span class="line">   &#125;</span><br><span class="line">   wx.setStorageSync(<span class="string">&#x27;searchRecord&#x27;</span>, searchRecord)</span><br><span class="line">   wx.navigateTo(&#123;</span><br><span class="line">     url: <span class="string">&#x27;/pages/dyeingFinishing/dyeingFinishingSearch/dyeingFinishingSearch?dyeingStatus=10&#x27;</span> + <span class="string">&#x27;&amp;orderDeliveryDate=1&#x27;</span> + <span class="string">&#x27;&amp;searchType=2&#x27;</span>+<span class="string">&#x27;&amp;factory=&#x27;</span>+e.currentTarget.dataset.message</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><p>21.小程序对象中的值无法进行双向绑定，需要通过bindinput进行实时改变</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder-class</span>=<span class="string">&quot;input_placeholder&quot;</span>  <span class="attr">bindinput</span>=<span class="string">&quot;bindInput&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;item.rejectsWeight&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入废品重量&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">bindInput</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="built_in">this</span>.data.personList;</span><br><span class="line">    arr[event.target.dataset.index].orderList[event.target.dataset.childindex].rejectsWeight = event.detail.value</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      personList: arr</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>22.双层for循环</p><p>小程序双层for循环想要分别拿到内外层的item和index时，要起不同的别名</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weighing_container_list_Data&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;testList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;deviceNumber&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weighing_container_list_item&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;item.orderList&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;items&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;childIndex&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;workNo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>23.返回上一页</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.navigateBack(&#123;</span><br><span class="line">    delta: 1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>24.自定义组件修改子组件样式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 子组件</span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&#x27;nav-wrap&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&#x27;nav-title&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">//对应js文件</span><br><span class="line">Component(&#123;</span><br><span class="line">  externalClasses: [&#x27;nav-wrap&#x27;,&#x27;nav-title&#x27;],  //需要改变样式的类名</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//父组件</span><br><span class="line"><span class="tag">&lt;<span class="name">nav-bar</span> <span class="attr">nav-wrap</span>=<span class="string">&quot;navbar&quot;</span> <span class="attr">nav-title</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">nav-bar</span>&gt;</span></span><br><span class="line">//设置新的样式</span><br><span class="line">.navbar&#123;&#125;</span><br><span class="line">.title&#123;&#125;</span><br></pre></td></tr></table></figure><p>遇到的问题： 只要子组件使用externalClasses外部样式类字段，子组件样式完全失效，还未找到解决办法</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;小程序开发&lt;/p&gt;
&lt;h3 id=&quot;一、申请小程序账号&quot;&gt;&lt;a href=&quot;#一、申请小程序账号&quot; class=&quot;headerlink&quot; title=&quot;一、申请小程序账号&quot;&gt;&lt;/a&gt;一、申请小程序账号&lt;/h3&gt;&lt;p&gt;一个邮箱只能申请一个小程序账号，对应一个小程序项目，个人最</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>2021前端面试题</title>
    <link href="http://example.com/2022/10/10/2021%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <id>http://example.com/2022/10/10/2021%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/</id>
    <published>2022-10-10T09:06:16.130Z</published>
    <updated>2022-10-10T09:12:41.926Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前端面试题"><a href="#前端面试题" class="headerlink" title="前端面试题"></a>前端面试题</h1><p>1.以下操作输出了什么？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">arr.pop();</span><br><span class="line">arr.concat([<span class="number">6</span>,<span class="number">7</span>]);</span><br><span class="line">arr.push(<span class="number">8</span>);</span><br><span class="line">arr.reverse();</span><br><span class="line"><span class="built_in">console</span>.log(arr); </span><br><span class="line"><span class="comment">//结果：[8, 4, 3, 2, 1]</span></span><br><span class="line"><span class="comment">//因为concat返回的是一个新的数组，原数组不会改变</span></span><br></pre></td></tr></table></figure><p>2.方法 test()和obj.test() 输出什么？为什么？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;global&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name:<span class="string">&#x27;obj&#x27;</span>,</span><br><span class="line">    test:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> name = <span class="string">&#x27;scope&#x27;</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> test = obj.test;</span><br><span class="line">test();  <span class="comment">// global</span></span><br><span class="line">obj.test(); <span class="comment">//obj</span></span><br></pre></td></tr></table></figure><p>3.使用快速排序对下列数组进行排序</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">62</span>,<span class="number">3</span>,<span class="number">44</span>,<span class="number">89</span>,<span class="number">632</span>];</span><br></pre></td></tr></table></figure><p>原理： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.在一个数集中，选择一个元素作为”基准“</span><br><span class="line">2.所有小于“基准”的元素，都移动到”基准“的左边；所有大于”基准“的元素，都移动到”基准“的右边</span><br><span class="line">3.对“基准”的左边和右边两个子集，不断重复上边的第一步和第二步，直到所有子集的元素只剩下一个为止。</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">62</span>, <span class="number">3</span>, <span class="number">44</span>, <span class="number">89</span>, <span class="number">632</span>];</span><br><span class="line"><span class="keyword">var</span> quickSort = <span class="function"><span class="keyword">function</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> pivotIndex = <span class="built_in">Math</span>.floor(arr.length / <span class="number">2</span>);</span><br><span class="line">  <span class="comment">// 将基准与原数组分离</span></span><br><span class="line">  <span class="keyword">var</span> pivot = arr.splice(pivotIndex, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> left = [];</span><br><span class="line">  <span class="keyword">var</span> right = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i] &lt; pivot) &#123;</span><br><span class="line">      left.push(arr[i]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      right.push(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> quickSort(left).concat([pivot], quickSort(right));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>4.冒泡排序</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> quickSort = <span class="function"><span class="keyword">function</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length-<span class="number">1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i+<span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">      count++</span><br><span class="line">      <span class="keyword">if</span>(arr[j]&lt;arr[i])&#123;</span><br><span class="line">        <span class="keyword">let</span> value = arr[i]</span><br><span class="line">        arr[i]=arr[j]</span><br><span class="line">        arr[j]=value</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>5.同步、异步，微任务、宏任务</p><p>js是单线程执行的，js中的任务按照从上到下的顺序依次执行，单如果一个任务需要消耗太长的时间，那后边的任务就需要等待，为了解决这种情况，将任务分为了同步和异步。而异步又分为了微任务和宏任务。</p><p>宏任务：  setTimeout、setInterval、js主代码、setImmediate(Node)、requestAnimationFrame(浏览器)</p><p>微任务：  process.nextTick、Promise的then方法</p><p>执行过程：  同步-&gt;异步-&gt;微任务-&gt;宏任务</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;6&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;7&#x27;</span>); <span class="comment">//同步</span></span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;10&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;11&#x27;</span>);</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//输出结果：1,7,6,8,2,4,3,5,9,11,10,12</span></span><br></pre></td></tr></table></figure><p>6.实现：  有5个灯，5个灯随机亮，不知道亮哪个，但是亮的次数相同</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是一个随机数的问题，因为生成一定范围内的随机数的概率是相同的，根据生成的随机，去选择让哪个灯变亮</span></span><br><span class="line"><span class="keyword">let</span> count1=<span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> count2=<span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> count3=<span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> count4=<span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> count5=<span class="number">0</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> x=<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (<span class="number">1</span>,<span class="number">16</span>)) + <span class="number">1</span>; <span class="comment">//生成1-16之间的随机整数，不包含16</span></span><br><span class="line">    <span class="keyword">if</span>(x===<span class="number">1</span>||x===<span class="number">2</span>||x===<span class="number">3</span>)&#123;</span><br><span class="line">     count1++ <span class="comment">//变成让第一个灯亮的操作，下边的判断也是如此</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(x===<span class="number">4</span>||x===<span class="number">5</span>||x===<span class="number">6</span>)&#123;</span><br><span class="line">     count2++</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(x===<span class="number">7</span>||x===<span class="number">8</span>||x===<span class="number">9</span>)&#123;</span><br><span class="line">     count3++</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(x===<span class="number">10</span>||x===<span class="number">11</span>||x===<span class="number">12</span>)&#123;</span><br><span class="line">     count4++</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     count5++</span><br><span class="line">&#125;</span><br><span class="line">    <span class="built_in">console</span>.log(count1,count2,count3);</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br></pre></td></tr></table></figure><p>7.一共有9个球，给你一个天枰，其中有一个球的质量和其他球不一样，怎样快速找到这个球？（假设这个球的质量偏高）</p><p>最优的方法： 每三个一组，拿两组放在天枰上找到偏重的那一组，然后再把偏重的那一组里的两个拿到天枰上进行称重，就可以找到偏重的那个球，一共需要两步</p><p>8.链表</p><p>9.给定一颗二叉树，根节点是1，第二层是2和3，第三层是4，5，6，7，请遍历这个二叉树，并按照1，2，3，4，5，6，7的顺序输出结果。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tree = &#123;</span><br><span class="line">  value: <span class="number">1</span>,</span><br><span class="line">  left: &#123;</span><br><span class="line">    value: <span class="number">2</span>,</span><br><span class="line">    left: &#123;</span><br><span class="line">      value: <span class="number">4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    right: &#123;</span><br><span class="line">      value: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  right: &#123;</span><br><span class="line">    value: <span class="number">3</span>,</span><br><span class="line">    left: &#123;</span><br><span class="line">      value: <span class="number">6</span></span><br><span class="line">    &#125;,</span><br><span class="line">    right: &#123;</span><br><span class="line">      value: <span class="number">7</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> levelOrderTraversal = <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!node) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Empty Tree&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> que = [];</span><br><span class="line">  que.push(node);</span><br><span class="line">  <span class="keyword">while</span> (que.length !== <span class="number">0</span>) &#123;</span><br><span class="line">    node = que.shift();</span><br><span class="line">    <span class="built_in">console</span>.log(node.value);</span><br><span class="line">    <span class="keyword">if</span> (node.left) que.push(node.left);</span><br><span class="line">    <span class="keyword">if</span> (node.right) que.push(node.right);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">levelOrderTraversal(tree)</span><br></pre></td></tr></table></figure><p>10.补充find函数，实现链式调用</p><p>方法一：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params">dataList</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> query = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">     query.where = <span class="function"><span class="keyword">function</span> <span class="title">where</span>(<span class="params">condition</span>) </span>&#123;</span><br><span class="line">       <span class="keyword">var</span> conditionKeys = <span class="built_in">Object</span>.keys(condition);</span><br><span class="line">       dataList = dataList.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> conditionKeys.every(<span class="function"><span class="params">key</span> =&gt;</span> condition[key].test(item[key]))</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="keyword">return</span> query;</span><br><span class="line">     &#125;;</span><br><span class="line"></span><br><span class="line">     query.orderBy = <span class="function"><span class="keyword">function</span> <span class="title">orderBy</span>(<span class="params">key, direction</span>) </span>&#123;</span><br><span class="line">       dataList.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> direction === <span class="string">&quot;desc&quot;</span> ? b[key] - a[key] : a[key] - b[key];</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="keyword">return</span> dataList;</span><br><span class="line">     &#125;;</span><br><span class="line">     <span class="keyword">return</span> query;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> data = [</span><br><span class="line">     &#123; <span class="attr">userId</span>: <span class="number">8</span>, <span class="attr">title</span>: <span class="string">&quot;title1&quot;</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">userId</span>: <span class="number">11</span>, <span class="attr">title</span>: <span class="string">&quot;other&quot;</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">userId</span>: <span class="number">15</span>, <span class="attr">title</span>: <span class="literal">null</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">userId</span>: <span class="number">19</span>, <span class="attr">title</span>: <span class="string">&quot;title2&quot;</span> &#125;</span><br><span class="line">   ];</span><br><span class="line">   <span class="comment">// 查找data中，符合where中条件的数据，并根据orderBy中的条件进行排序</span></span><br><span class="line">   <span class="keyword">var</span> result = find(data)</span><br><span class="line">     .where(&#123;</span><br><span class="line">       title: <span class="regexp">/\d$/</span> <span class="comment">//过滤出数组中，满足title字段中符合/\d$/的项</span></span><br><span class="line">     &#125;)</span><br><span class="line">     .orderBy(<span class="string">&quot;userId&quot;</span>, <span class="string">&quot;desc&quot;</span>); <span class="comment">//数组中的项按照userId进行倒序排列</span></span><br><span class="line">   <span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure><p>方法二：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Query</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params">dataList</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataList = dataList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    where (conditions) &#123;</span><br><span class="line">        <span class="keyword">const</span> keyList = <span class="built_in">Object</span>.keys(conditions)</span><br><span class="line">        <span class="keyword">const</span> dataList = <span class="built_in">this</span>.dataList.filter(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> keyList.every(<span class="function"><span class="params">k</span> =&gt;</span> conditions[k].test(data[k]))</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Query(dataList)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">orderBy</span>(<span class="params">key, orderType</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> func = <span class="function">(<span class="params">a, b</span>) =&gt;</span> (a[key] - b[key]) * (orderType == <span class="string">&#x27;desc&#x27;</span> ? -<span class="number">1</span> : <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">const</span> list = [...this.dataList].sort(func)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Query(list)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span> (<span class="params">dataList</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Query(dataList)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">  &#123; <span class="attr">userId</span>: <span class="number">8</span>, <span class="attr">title</span>: <span class="string">&quot;title1&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">userId</span>: <span class="number">11</span>, <span class="attr">title</span>: <span class="string">&quot;other&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">userId</span>: <span class="number">15</span>, <span class="attr">title</span>: <span class="literal">null</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">userId</span>: <span class="number">19</span>, <span class="attr">title</span>: <span class="string">&quot;title2&quot;</span> &#125;</span><br><span class="line">];</span><br><span class="line"><span class="comment">// 查找data中，符合where中条件的数据，并根据orderBy中的条件进行排序</span></span><br><span class="line"><span class="keyword">var</span> result = find(data)</span><br><span class="line">  .where(&#123;</span><br><span class="line">    title: <span class="regexp">/\d$/</span> <span class="comment">//过滤出数组中，满足title字段中符合/\d$/的项</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .orderBy(<span class="string">&quot;userId&quot;</span>, <span class="string">&quot;desc&quot;</span>); <span class="comment">//数组中的项按照userId进行倒序排列</span></span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;前端面试题&quot;&gt;&lt;a href=&quot;#前端面试题&quot; class=&quot;headerlink&quot; title=&quot;前端面试题&quot;&gt;&lt;/a&gt;前端面试题&lt;/h1&gt;&lt;p&gt;1.以下操作输出了什么？&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://example.com/2022/10/10/%E9%A1%B5%E9%9D%A2%E5%A4%A7%E5%9B%BE%E8%87%AA%E9%80%82%E5%BA%94/"/>
    <id>http://example.com/2022/10/10/%E9%A1%B5%E9%9D%A2%E5%A4%A7%E5%9B%BE%E8%87%AA%E9%80%82%E5%BA%94/</id>
    <published>2022-10-10T09:02:51.159Z</published>
    <updated>2021-12-13T07:36:32.713Z</updated>
    
    <content type="html"><![CDATA[<p>监控大图的制作主要考虑自适应的问题，根据屏幕大小进行自动伸缩的一个功能。制作大图可以选择使用rem布局和百分比布局，如果选择使用rem布局，可以在前端配置一个postcss-px2rem ，px2rem-loader进行适配，可以scss直接以方法的形式定义变量，在css代码中则使用px2rem(20px)来定义宽高。</p><p>做大图时会遇到图表的一个自适应，默认向echarts图表是不会自适应的，需要自己手动设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ref&#x3D;&quot;harvest&quot; id&#x3D;&quot;shape&quot; style&#x3D;&quot;width:100%;height:350px&quot;&gt;&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">resizeTimer: null,</span><br><span class="line">        harvest: null,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        let harvest &#x3D; this.$echarts.init(this.$refs.harvest);</span><br><span class="line">      let _this &#x3D; this;</span><br><span class="line">      _this.harvest &#x3D; harvest;</span><br><span class="line">         harvest.setOption(this.makeOption());</span><br><span class="line">        </span><br><span class="line">         window.addEventListener(&quot;resize&quot;, function() &#123;</span><br><span class="line">            if (_this.resizeTimer) &#123;</span><br><span class="line">              clearTimeout(_this.resizeTimer);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (_this.harvest) &#123;</span><br><span class="line">              _this.resizeTimer &#x3D; setTimeout(function() &#123;</span><br><span class="line">                _this.harvest.resize();</span><br><span class="line">              &#125;, 100);</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;监控大图的制作主要考虑自适应的问题，根据屏幕大小进行自动伸缩的一个功能。制作大图可以选择使用rem布局和百分比布局，如果选择使用rem布局，可以在前端配置一个postcss-px2rem ，px2rem-loader进行适配，可以scss直接以方法的形式定义变量，在css代</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>element-ui文件上传</title>
    <link href="http://example.com/2022/10/10/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>http://example.com/2022/10/10/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</id>
    <published>2022-10-10T09:02:33.205Z</published>
    <updated>2022-10-10T09:16:28.432Z</updated>
    
    <content type="html"><![CDATA[<p>使用element-ui组件中的upload组件实现多个文件的上传，文件上传基本实现了以下几个功能： </p><p>1.文件上传是必填项，上传成功后下边的提示要消失</p><p>2.限制文件上传类型、数量以及大小</p><p>3.文件在上传过程中不允许提交</p><p>4.文件上传成功后，自己可以点击下载下来</p><p>5.特殊情况下自己上传的文件不允许删除</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-form</span><br><span class="line">     :model&#x3D;&quot;ruleForm&quot;</span><br><span class="line">     :rules&#x3D;&quot;rules&quot;</span><br><span class="line">     ref&#x3D;&quot;ruleForm&quot;</span><br><span class="line">     label-width&#x3D;&quot;150px&quot;</span><br><span class="line">     class&#x3D;&quot;demo-ruleForm&quot;</span><br><span class="line">        &gt;</span><br><span class="line">    &lt;el-form-item</span><br><span class="line">            label&#x3D;&quot;申请表扫描件（加盖企业公章）&quot;</span><br><span class="line">            class&#x3D;&quot;checkTable&quot;</span><br><span class="line">            prop&#x3D;&quot;acceptFileList&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-upload</span><br><span class="line">              class&#x3D;&quot;upload-demo&quot;</span><br><span class="line">              :disabled&#x3D;&quot;isShowDelete&quot;  &#x2F;&#x2F;是否可以删除文件</span><br><span class="line">              :action&#x3D;&quot;uploadFile&quot;</span><br><span class="line">              :limit&#x3D;&quot;1&quot;  &#x2F;&#x2F;限制上传文件的个数</span><br><span class="line">              accept&#x3D;&quot;.pdf,.zip,.rar&quot;  &#x2F;&#x2F;限制上传文件的格式</span><br><span class="line">              :on-exceed&#x3D;&quot;handleExceed&quot;  &#x2F;&#x2F;文件超出个数限制的回调</span><br><span class="line">              :on-success&#x3D;&quot;uploadSuccessAccept&quot; &#x2F;&#x2F;文件上传成功的回调</span><br><span class="line">              :on-progress&#x3D;&quot;handleUpProgress&quot;  &#x2F;&#x2F;文件上传中的回调</span><br><span class="line">              :before-upload&#x3D;&quot;beforeUpload&quot;  &#x2F;&#x2F;文件上传前的回调</span><br><span class="line">              :on-error&#x3D;&quot;uploadErrorAccept&quot;  &#x2F;&#x2F;文件上传错误的回调</span><br><span class="line">              :file-list&#x3D;&quot;ruleForm.acceptFileList&quot; &#x2F;&#x2F;已上传文件的列表</span><br><span class="line">              :on-remove&#x3D;&quot;removeAccept&quot;  &#x2F;&#x2F;文件移出的回调</span><br><span class="line">              :on-preview&#x3D;&quot;downloadFile&quot; &#x2F;&#x2F;已上传的文件下载的回调</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot;&gt;点击上传&lt;&#x2F;el-button&gt;</span><br><span class="line">              &lt;div slot&#x3D;&quot;tip&quot; class&#x3D;&quot;el-upload__tip&quot;&gt;</span><br><span class="line">                只能上传pdf&#x2F;zip&#x2F;rar文件</span><br><span class="line">              &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;&#x2F;el-upload&gt;</span><br><span class="line">          &lt;&#x2F;el-form-item&gt;</span><br><span class="line">          &lt;el-form-item&gt;</span><br><span class="line">            &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;submitForm(&#39;ruleForm&#39;)&quot;</span><br><span class="line">              &gt;提交&lt;&#x2F;el-button</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;&#x2F;el-form-item&gt;</span><br><span class="line">&lt;&#x2F;el-form&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        isShowDelete:true,</span><br><span class="line">        isFileUploadSuccess:true,  &#x2F;&#x2F;文件是否上传成功</span><br><span class="line">        uploadFile: &#39;&#x2F;yongkang&#x2F;dtsum&#x2F;file&#x2F;fileController&#x2F;reUploadFile&#39;, &#x2F;&#x2F;上传文件的接口地址</span><br><span class="line">        fileList1:[],</span><br><span class="line">        acceptFileId:0,</span><br><span class="line">        ruleForm:&#123;</span><br><span class="line">            acceptFileList:[]</span><br><span class="line">        &#125;,</span><br><span class="line">        rules:&#123;</span><br><span class="line">            acceptFileList: [</span><br><span class="line">              &#123;</span><br><span class="line">                message: &#39;请上传申请表扫描件&#39;,</span><br><span class="line">                trigger: &#39;change&#39;,</span><br><span class="line">                required: true</span><br><span class="line">              &#125;</span><br><span class="line">        ],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;，</span><br><span class="line">  methods:&#123;</span><br><span class="line">     &#x2F;&#x2F; 文件上传之前判断类型</span><br><span class="line">    beforeUpload(file) &#123;</span><br><span class="line">      var type &#x3D; file.name.substring(file.name.lastIndexOf(&#39;.&#39;) + 1)</span><br><span class="line">      if (type !&#x3D;&#x3D; &#39;pdf&#39; &amp;&amp; type !&#x3D;&#x3D; &#39;zip&#39; &amp;&amp; type !&#x3D;&#x3D; &#39;rar&#39;) &#123;</span><br><span class="line">        this.$message.warning(&#39;请上传pdf&#x2F;zip&#x2F;rar格式的文件&#39;)</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">      const isLt2M &#x3D; file.size &#x2F; 1024 &#x2F; 1024 &lt; 20</span><br><span class="line">      if (!isLt2M) &#123;</span><br><span class="line">        this.$message.warning(&#39;上传文件大小不能超过 20MB&#39;)</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 文件上传个数限制</span><br><span class="line">    handleExceed() &#123;</span><br><span class="line">      this.$message.warning(&#39;最多上传1个文件&#39;)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F;文件上传中的函数</span><br><span class="line">    handleUpProgress()&#123;</span><br><span class="line">        this.isFileUploadSuccess&#x3D;false;  &#x2F;&#x2F;代表在上传中，整个表单不能提交</span><br><span class="line">&#125;,</span><br><span class="line">    &#x2F;&#x2F; 文件上传成功调用的函数</span><br><span class="line">    uploadSuccessAccept(response, file, fileList1) &#123;</span><br><span class="line">      this.isFileUploadSuccess&#x3D;true;</span><br><span class="line">      this.ruleForm.acceptFileList.push(file)</span><br><span class="line">      &#x2F;&#x2F;上传成功后取消提示</span><br><span class="line">      this.$refs.ruleForm.validateField(&#39;acceptFileList&#39;)</span><br><span class="line">      this.acceptFileId &#x3D; response</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F;文件上传失败的函数</span><br><span class="line">    uploadErrorAccept()&#123;</span><br><span class="line">      this.isFileUploadSuccess &#x3D; true</span><br><span class="line">      this.acceptFileId &#x3D; 0</span><br><span class="line">      this.$message.warning(&#39;上传失败&#39;)</span><br><span class="line">&#125;,</span><br><span class="line">    &#x2F;&#x2F; 移除文件触发的函数</span><br><span class="line">    removeFile1(file, fileList) &#123;</span><br><span class="line">      this.ruleForm.acceptFileList.pop(file)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F;文件下载</span><br><span class="line">    downloadFile(file) &#123;</span><br><span class="line">      window.location.href &#x3D; file.url</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F;获取整个项目信息是</span><br><span class="line">    getProjectMessage()&#123;</span><br><span class="line">        this.acceptFileId &#x3D; res.data.body.projectInfo.ykipApplication</span><br><span class="line">        this.ruleForm.acceptFileList.push(&#123;</span><br><span class="line">              id: this.acceptFileId,</span><br><span class="line">              name: &#39;申请表扫描件&#39;,</span><br><span class="line">              url:</span><br><span class="line">                &#39;&#x2F;yongkang&#x2F;dtsum&#x2F;file&#x2F;fileController&#x2F;reDownloadFile?fileId&#x3D;&#39; +</span><br><span class="line">                this.acceptFileId</span><br><span class="line">            &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">    submitForm(formName) &#123;</span><br><span class="line">      this.$refs[formName].validate(valid &#x3D;&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          this.submitProject(flag)  &#x2F;&#x2F;提交的接口</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.$message.error(&#39;请先填写必填项&#39;)</span><br><span class="line">          return false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;使用element-ui组件中的upload组件实现多个文件的上传，文件上传基本实现了以下几个功能： &lt;/p&gt;
&lt;p&gt;1.文件上传是必填项，上传成功后下边的提示要消失&lt;/p&gt;
&lt;p&gt;2.限制文件上传类型、数量以及大小&lt;/p&gt;
&lt;p&gt;3.文件在上传过程中不允许提交&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>将html元素转换为图片并可以下载</title>
    <link href="http://example.com/2022/10/10/%E5%B0%86html%E5%85%83%E7%B4%A0%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9B%BE%E7%89%87%E5%B9%B6%E5%8F%AF%E4%BB%A5%E4%B8%8B%E8%BD%BD%EF%BC%8C%E5%85%B7%E4%BD%93%E7%A4%BA%E4%BE%8B%E5%A6%82%E4%B8%8B/"/>
    <id>http://example.com/2022/10/10/%E5%B0%86html%E5%85%83%E7%B4%A0%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9B%BE%E7%89%87%E5%B9%B6%E5%8F%AF%E4%BB%A5%E4%B8%8B%E8%BD%BD%EF%BC%8C%E5%85%B7%E4%BD%93%E7%A4%BA%E4%BE%8B%E5%A6%82%E4%B8%8B/</id>
    <published>2022-10-10T08:59:57.656Z</published>
    <updated>2022-10-10T09:14:13.178Z</updated>
    
    <content type="html"><![CDATA[<p>将html元素转换为图片并可以下载，具体示例如下: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;previewPrint&quot; id&#x3D;&quot;previewPrint&quot; ref&#x3D;&quot;imageWrapper&quot;&gt;</span><br><span class="line">        &lt;div v-for&#x3D;&quot;item in barcodeList&quot; :key&#x3D;&quot;item.index&quot; class&#x3D;&quot;printBar&quot;&gt;</span><br><span class="line">          &lt;div&gt;料箱编码：AB0300001&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;printDescribe&quot;&gt;</span><br><span class="line">            &lt;div&gt;型号：AB-001&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div&gt;重量(kg)：10.15&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;barcode :value&#x3D;&quot;item.value&quot; height&#x3D;&quot;70&quot;&gt;</span><br><span class="line">            &#123;&#123; item.value &#125;&#125;</span><br><span class="line">          &lt;&#x2F;barcode&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&#x2F;&#x2F;转换工具</span><br><span class="line">import html2canvas from &#39;html2canvas&#39;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//点击下载调用的函数</span></span><br><span class="line"><span class="function"><span class="title">download</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      html2canvas(<span class="built_in">this</span>.$refs.imageWrapper, &#123;</span><br><span class="line">        backgroundColor: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">        scal: <span class="number">2</span></span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">canvas</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> context = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">        <span class="comment">// 关闭抗锯齿</span></span><br><span class="line">        context.mozImageSmoothingEnabled = <span class="literal">false</span>;</span><br><span class="line">        context.webkitImageSmoothingEnabled = <span class="literal">false</span>;</span><br><span class="line">        context.msImageSmoothingEnabled = <span class="literal">false</span>;</span><br><span class="line">        context.imageSmoothingEnabled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> dataURL = canvas.toDataURL(<span class="string">&#x27;image/png&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.createImgUrl = dataURL;</span><br><span class="line">        <span class="built_in">this</span>.fileDownload(dataURL);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">     fileDownload (downloadUrl) &#123;</span><br><span class="line">      <span class="keyword">let</span> aLink = <span class="built_in">document</span>.createElement(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">      aLink.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">      aLink.href = downloadUrl;</span><br><span class="line">      aLink.download = <span class="string">&#x27;料箱条形码.png&#x27;</span>;</span><br><span class="line">      <span class="comment">// 触发点击-然后移除</span></span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(aLink);</span><br><span class="line">      aLink.click();</span><br><span class="line">      <span class="built_in">document</span>.body.removeChild(aLink);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;将html元素转换为图片并可以下载，具体示例如下: &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span cl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>keep-alive</title>
    <link href="http://example.com/2022/10/10/keep-alive/"/>
    <id>http://example.com/2022/10/10/keep-alive/</id>
    <published>2022-10-10T08:59:41.766Z</published>
    <updated>2022-10-10T09:01:43.458Z</updated>
    
    <content type="html"><![CDATA[<p>需求：系统列表页设置好的筛选条件，离开本页面，下次再点进来，不会被清空。</p><p>解决的方法：使用keep-alive</p><p>使用方法： </p><p>1.需要保存数据的组件需要用keep-alive作为外层标签，可以放在app.vue中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;keep-alive&gt;</span><br><span class="line">    &lt;!-- 需要缓存的视图组件 --&gt;</span><br><span class="line">    &lt;router-view v-if&#x3D;&quot;$route.meta.keepAlive&quot;&gt;&lt;&#x2F;router-view&gt;</span><br><span class="line">&lt;&#x2F;keep-alive&gt;</span><br><span class="line">&lt;!-- 不需要缓存的视图组件 --&gt;</span><br><span class="line">&lt;router-view v-if&#x3D;&quot;!$route.meta.keepAlive&quot;&gt;&lt;&#x2F;router-view&gt;</span><br></pre></td></tr></table></figure><p>2.在路由文件中添加要进行缓存的标识，keepAlive为true时进行缓存</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: &quot;&#x2F;materialManage&#x2F;materialOutput&quot;, &#x2F;&#x2F; 原材料出仓</span><br><span class="line">    name: &quot;materialOutput&quot;,</span><br><span class="line">    component: (resolve) &#x3D;&gt; require([&quot;..&#x2F;views&#x2F;pages&#x2F;materialOutput&quot;], resolve),</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: &quot;原材料出仓&quot;,</span><br><span class="line">      keepAlive: true,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="原理和理解"><a href="#原理和理解" class="headerlink" title="原理和理解"></a>原理和理解</h3><p>1.keep-alive不会生成真正的DOM节点。Vue在初始化生命周期的时候，为组件实例建立父子关系会根据abstract属性决定是否忽略某个组件。在keep-alive中，设置了abstract:true，那Vue就会跳过该组件实例</p><p>2.keep-alive的生命周期</p><ul><li>初次进入时：created &gt; mounted &gt; activated；退出后触发 deactivated</li><li>再次进入：会触发 activated；事件挂载的方法等，只执行一次的放在 mounted 中；组件每次进去执行的方法放在 activated 中</li></ul><p>注：activated只在被 keep-alive 缓存的组件激活时调；deactivated被 keep-alive 缓存的组件停用时调用。</p><p>3.属性：</p><ul><li><p><code>include</code> - 字符串或正则表达式。只有名称匹配的组件会被缓存。</p></li><li><p><code>exclude</code> - 字符串或正则表达式。任何名称匹配的组件都不会被缓存。</p></li><li><p><code>max</code> - 数字。最多可以缓存多少组件实例。一旦这个数字达到了，在新实例被创建之前，已缓存组件中最久没有被访问的实例会被销毁掉。</p></li></ul><p>实例：结合澳亚项目，顶部菜单存储在vuex，如果在顶部菜单栏被关掉，之前的信息不进行存储</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">    $route(to, <span class="keyword">from</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> routerName = <span class="built_in">this</span>.$store.state.tagsView.visitedViews.find(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> item.name === <span class="keyword">from</span>.name;</span><br><span class="line">      &#125;);</span><br><span class="line"> <span class="keyword">if</span> (<span class="string">&quot;keepAlive&quot;</span> <span class="keyword">in</span> to.meta) &#123;</span><br><span class="line">         to.meta.keepAlive=<span class="literal">true</span>;  <span class="comment">//解决第一次进入缓存无效的问题</span></span><br><span class="line">       &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="string">&quot;keepAlive&quot;</span> <span class="keyword">in</span> <span class="keyword">from</span>.meta) &#123;</span><br><span class="line">        <span class="keyword">if</span> (routerName === <span class="literal">undefined</span>) &#123;</span><br><span class="line">          <span class="keyword">from</span>.meta.keepAlive = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">from</span>.meta.keepAlive = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>总结： 一般情况下，我们都可以通过设置keepAlive为false清除缓存，但对于查看详情，类似于首检查看详情时，详情页会保存记录，下次再查看另一个的详情，不需要上一次的缓存，解决的办法如下： </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在首检详情页面添加如下代码</span></span><br><span class="line"><span class="function"><span class="title">beforeRouteLeave</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">Array</span>.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> index = <span class="built_in">this</span>.indexOf(val);</span><br><span class="line">      <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.splice(index, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;; <span class="comment">//在数组原型上添加移除指定元素（非指定方法）</span></span><br><span class="line">    <span class="comment">//his.$vnode.parent.componentInstance.cache是keep-alive存放的缓存</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="built_in">this</span>.$vnode.parent.componentInstance.cache) &#123;</span><br><span class="line">      <span class="comment">//删除firstInspectionDetail页面中的缓存，在该页面被完全关闭时，也就是不存在顶部导航栏里</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="built_in">this</span>.$vnode.parent.componentInstance.cache[key].elm.className ==</span><br><span class="line">          <span class="string">&quot;firstInspectionDetail&quot;</span> &amp;&amp;</span><br><span class="line">        <span class="built_in">this</span>.$store.state.tagsView.visitedViews.find(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> item.name == <span class="string">&quot;firstInspectionDetail&quot;</span>;</span><br><span class="line">        &#125;) == <span class="literal">undefined</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>.$vnode.parent.componentInstance.cache[key];</span><br><span class="line">        <span class="built_in">this</span>.$vnode.parent.componentInstance.keys.remove(key);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    next();</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;需求：系统列表页设置好的筛选条件，离开本页面，下次再点进来，不会被清空。&lt;/p&gt;
&lt;p&gt;解决的方法：使用keep-alive&lt;/p&gt;
&lt;p&gt;使用方法： &lt;/p&gt;
&lt;p&gt;1.需要保存数据的组件需要用keep-alive作为外层标签，可以放在app.vue中&lt;/p&gt;
&lt;figu</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>自定义筛选条件</title>
    <link href="http://example.com/2022/10/10/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AD%9B%E9%80%89/"/>
    <id>http://example.com/2022/10/10/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AD%9B%E9%80%89/</id>
    <published>2022-10-10T08:53:20.089Z</published>
    <updated>2022-10-10T08:57:58.496Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从多选框中挑选作为新的筛选条件</span></span><br><span class="line">shaixuanArray:[]<span class="comment">//筛选条件数组</span></span><br><span class="line">duoxuanArray:[]<span class="comment">//多选框数组</span></span><br><span class="line">isShowDiv:<span class="literal">false</span><span class="comment">//自定义筛选条件整个框是否展示</span></span><br><span class="line">isShowBox:<span class="literal">false</span><span class="comment">//自定义筛选多选框是否显示</span></span><br><span class="line">handleClickFilter()<span class="comment">//点击自定义筛选</span></span><br><span class="line">handleClickConfirm()<span class="comment">//点击确定</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">handleClickFilter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.isShowBox=!<span class="built_in">this</span>.isShowBox;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.isShowBox===<span class="literal">true</span>)<span class="comment">//从筛选条件跳转到多选框</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="built_in">this</span>.isShowDiv=<span class="literal">true</span>;</span><br><span class="line"><span class="built_in">this</span>.duoxuanArray=<span class="built_in">this</span>.shaixuanArray;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;<span class="comment">//从多选框跳到筛选条件</span></span><br><span class="line">  <span class="built_in">this</span>.shaixuanArray.length===<span class="number">0</span>?<span class="built_in">this</span>.isShowDiv=<span class="literal">false</span>:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">handleClickConfirm</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.isShowBox=<span class="literal">false</span>;</span><br><span class="line"><span class="built_in">this</span>.shaixuanArray=<span class="built_in">this</span>.duoxuanArray;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.shaixuanArray.length===<span class="number">0</span>)&#123;<span class="built_in">this</span>.isShowDiv=<span class="literal">false</span>&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;l</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>表格组件化</title>
    <link href="http://example.com/2022/10/10/%E8%A1%A8%E6%A0%BC%E8%AE%BE%E7%BD%AE%E7%BB%84%E4%BB%B6%E5%8C%96/"/>
    <id>http://example.com/2022/10/10/%E8%A1%A8%E6%A0%BC%E8%AE%BE%E7%BD%AE%E7%BB%84%E4%BB%B6%E5%8C%96/</id>
    <published>2022-10-10T05:56:21.490Z</published>
    <updated>2022-10-10T08:41:37.701Z</updated>
    
    <content type="html"><![CDATA[<p>表格设置组件化的具体实现，利用element-ui的穿梭框组件，修改为适用于项目可以调整顺序的组件</p><h2 id="一、非完美写法"><a href="#一、非完美写法" class="headerlink" title="一、非完美写法"></a>一、非完美写法</h2><p>表格设置组件的使用，主要是在父组件需要按照一下规矩定义：</p><h3 id="父组件："><a href="#父组件：" class="headerlink" title="父组件："></a>父组件：</h3><p>1.引入表格设置的子组件并注册：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import TableSetting from &quot;..&#x2F;..&#x2F;components&#x2F;home&#x2F;tableSetting.vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">   components: &#123;</span><br><span class="line">    TableSetting</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.在页面中使用组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 穿梭框的弹出框 --&gt;</span><br><span class="line">&lt;TableSetting</span><br><span class="line">      :routerPath&#x3D;&quot;routerPath&quot;</span><br><span class="line">      :theadDateReal&#x3D;&quot;bindTheadDateReal&quot;</span><br><span class="line">      @getTableDataList&#x3D;&quot;bindTableDataList&quot;</span><br><span class="line">      :chuansuoDialogVisible.sync&#x3D;&quot;chuansuoDialogVisible&quot;</span><br><span class="line">&gt;&lt;&#x2F;TableSetting&gt;</span><br></pre></td></tr></table></figure><p>3.声明要进行表格设置的变量routerPath和iview表格中的表格数据theadDateReal，子组件中会用到（当页面存在两个表格设置时如下，一个时只留前两个）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      routerPath: &quot;&quot;, &#x2F;&#x2F;需要进行表格设置的表格接口api</span><br><span class="line">      bindTheadDateReal: [], &#x2F;&#x2F;真正表格绑定的表格头</span><br><span class="line">      bindTableDataList: [], &#x2F;&#x2F;表格的数据</span><br><span class="line">      chuansuoDialogVisible: false, &#x2F;&#x2F;弹窗是否显示</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.在方法中声明点击 “表格设置” 会触发的函数（当页面存在多个个表格设置时，可以写多个以下函数，就是赋值的内容变掉）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">showTableTitleDialog() &#123;</span><br><span class="line">      this.routerPath &#x3D;</span><br><span class="line">        &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;material&#x2F;materialController&#x2F;materialOutSearch&quot;;</span><br><span class="line">      this.bindTheadDateReal &#x3D; this.tableRealColumns;</span><br><span class="line">      this.bindTableDataList &#x3D; this.getTableDataList;</span><br><span class="line">      this.chuansuoDialogVisible &#x3D; true;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><h3 id="子组件："><a href="#子组件：" class="headerlink" title="子组件："></a>子组件：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 使用表格设置有一个约定:</span><br><span class="line">    注意：父组件写的时候不要放在引用组件的里边</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 穿梭框的弹出框 --&gt;</span><br><span class="line">    &lt;Modal</span><br><span class="line">      v-model&#x3D;&quot;chuansuoDialogVisible&quot;</span><br><span class="line">      title&#x3D;&quot;表格设置&quot;</span><br><span class="line">      :width&#x3D;&quot;600&quot;</span><br><span class="line">      :closable&#x3D;&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;20&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;chuanSuo&quot;&gt;</span><br><span class="line">            &lt;el-transfer</span><br><span class="line">              filterable</span><br><span class="line">              filter-placeholder&#x3D;&quot;请输入表头名称&quot;</span><br><span class="line">              :titles&#x3D;&quot;[&#39;未选字段&#39;, &#39;已选字段&#39;]&quot;</span><br><span class="line">              v-model&#x3D;&quot;value&quot;</span><br><span class="line">              :data&#x3D;&quot;data&quot;</span><br><span class="line">              target-order&#x3D;&quot;unshirt&quot;</span><br><span class="line">              @right-check-change&#x3D;&quot;rightCheck&quot;</span><br><span class="line">            &gt;&lt;&#x2F;el-transfer&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;4&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-up sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;upDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToUp&quot;</span><br><span class="line">            style&#x3D;&quot;margin-top:110px&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-down sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;downDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToDown&quot;</span><br><span class="line">            style&#x3D;&quot;margin:10px 0&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">      &lt;&#x2F;el-row&gt;</span><br><span class="line">      &lt;div slot&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">        &lt;Button @click&#x3D;&quot;cancleSet&quot;&gt;取 消&lt;&#x2F;Button&gt;</span><br><span class="line">        &lt;Button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;setTableTitle&quot;&gt;确 定&lt;&#x2F;Button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;Modal&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [</span><br><span class="line">    &quot;routerPath&quot;,</span><br><span class="line">    &quot;routerPath1&quot;,</span><br><span class="line">    &quot;chuansuoDialogVisible&quot;,</span><br><span class="line">    &quot;theadDateReal&quot;</span><br><span class="line">  ],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      data: [],</span><br><span class="line">      value: [],</span><br><span class="line">      upDisAbled: true,</span><br><span class="line">      downDisAbled: true,</span><br><span class="line">      tempSelectionKeys: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    chuansuoDialogVisible: function(val) &#123;</span><br><span class="line">      if (val) &#123;</span><br><span class="line">        this.showTableTitleDialog();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    &#x2F;&#x2F; 穿梭框右侧选中改变触发的事件</span><br><span class="line">    rightCheck(selectionKeys, changeKeys) &#123;</span><br><span class="line">      this.tempSelectionKeys &#x3D; selectionKeys;</span><br><span class="line">      if (selectionKeys.length &gt; 0) &#123;</span><br><span class="line">        this.upDisAbled &#x3D; false;</span><br><span class="line">        this.downDisAbled &#x3D; false;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.upDisAbled &#x3D; true;</span><br><span class="line">        this.downDisAbled &#x3D; true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项上移</span><br><span class="line">    handleToUp() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; 0) &#123;</span><br><span class="line">          this.value.splice(indexNum - 1, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum + 1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项下移</span><br><span class="line">    handleToDown() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; -1 &amp;&amp; indexNum !&#x3D;&#x3D; this.value.length - 1) &#123;</span><br><span class="line">          this.value.splice(indexNum + 2, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表头点击取消</span><br><span class="line">    cancleSet() &#123;</span><br><span class="line">      this.value &#x3D; [];</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 显示弹出框穿梭框中的字段</span><br><span class="line">    showTableTitleDialog() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;setFormView&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">            &#x2F;&#x2F; 穿梭框</span><br><span class="line">            const data &#x3D; [];</span><br><span class="line">            const cities &#x3D; res.data.body.allFields;</span><br><span class="line">            cities.forEach((city, index) &#x3D;&gt; &#123;</span><br><span class="line">              data.push(&#123;</span><br><span class="line">                label: city.fieldName,</span><br><span class="line">                key: city.fieldId</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            this.data &#x3D; data;</span><br><span class="line">            for (let i &#x3D; 0; i &lt; res.data.body.needFields.length; i++) &#123;</span><br><span class="line">              this.value.push(res.data.body.needFields[i].fieldId);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表格头显示字段</span><br><span class="line">    setTableTitle() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;editForm&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath,</span><br><span class="line">          fieldIdList: this.value</span><br><span class="line">        &#125;,</span><br><span class="line">        paramsSerializer: (params) &#x3D;&gt; &#123;</span><br><span class="line">          return this.qs.stringify(params, &#123; indices: false &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">            if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">              this.$Message.success(res.data.msg);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$Message.error(res.data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">            this.value.length &#x3D; 0;</span><br><span class="line">            this.$emit(&quot;theadDateReal&quot;, this.theadDateReal.length &#x3D; 0);</span><br><span class="line">            resolve();</span><br><span class="line">          &#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">            this.noShow();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    noShow() &#123;</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false);</span><br><span class="line">      this.$emit(&quot;tableDataList&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="二、较完美写法"><a href="#二、较完美写法" class="headerlink" title="二、较完美写法"></a>二、较完美写法</h2><h3 id="父组件"><a href="#父组件" class="headerlink" title="父组件"></a>父组件</h3><p>1.引入表格设置的子组件并注册</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import TableSetting from &quot;..&#x2F;..&#x2F;components&#x2F;home&#x2F;tableSetting.vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">   components: &#123;</span><br><span class="line">    TableSetting</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.api的定义</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;tableSetting :chuansuoDialogVisible.sync&#x3D;&quot;chuansuoDialogVisible&quot; :routerPath&#x3D;&quot;routerPath&quot; theadDateReal&#x3D;&quot;theadDateReal&quot; tableDataList&#x3D;&quot;tableDataList&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure><p>chuansuoDialogVisible    为是否显示表格设置弹窗</p><p>routerPath             为表格设置所在表格的接口地址</p><p>theadDateReal            为表格的表格头数组变量</p><p>tableDataList            为获取表格信息的函数名</p><h3 id="子组件"><a href="#子组件" class="headerlink" title="子组件"></a>子组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 使用表格设置有一个约定:</span><br><span class="line">    注意：父组件写的时候不要放在引用组件的里边</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 穿梭框的弹出框 --&gt;</span><br><span class="line">    &lt;Modal</span><br><span class="line">      v-model&#x3D;&quot;chuansuoDialogVisible&quot;</span><br><span class="line">      title&#x3D;&quot;表格设置&quot;</span><br><span class="line">      :width&#x3D;&quot;600&quot;</span><br><span class="line">      :closable&#x3D;&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;20&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;chuanSuo&quot;&gt;</span><br><span class="line">            &lt;el-transfer</span><br><span class="line">              filterable</span><br><span class="line">              filter-placeholder&#x3D;&quot;请输入表头名称&quot;</span><br><span class="line">              :titles&#x3D;&quot;[&#39;未选字段&#39;, &#39;已选字段&#39;]&quot;</span><br><span class="line">              v-model&#x3D;&quot;value&quot;</span><br><span class="line">              :data&#x3D;&quot;data&quot;</span><br><span class="line">              target-order&#x3D;&quot;unshirt&quot;</span><br><span class="line">              @right-check-change&#x3D;&quot;rightCheck&quot;</span><br><span class="line">            &gt;&lt;&#x2F;el-transfer&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;4&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-up sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;upDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToUp&quot;</span><br><span class="line">            style&#x3D;&quot;margin-top:110px&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-down sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;downDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToDown&quot;</span><br><span class="line">            style&#x3D;&quot;margin:10px 0&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">      &lt;&#x2F;el-row&gt;</span><br><span class="line">      &lt;div slot&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">        &lt;Button @click&#x3D;&quot;cancleSet&quot;&gt;取 消&lt;&#x2F;Button&gt;</span><br><span class="line">        &lt;Button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;setTableTitle&quot;&gt;确 定&lt;&#x2F;Button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;Modal&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [</span><br><span class="line">    &quot;routerPath&quot;,</span><br><span class="line">    &quot;routerPath1&quot;,</span><br><span class="line">    &quot;chuansuoDialogVisible&quot;,</span><br><span class="line">    &quot;theadDateReal&quot;</span><br><span class="line">  ],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      data: [],</span><br><span class="line">      value: [],</span><br><span class="line">      upDisAbled: true,</span><br><span class="line">      downDisAbled: true,</span><br><span class="line">      tempSelectionKeys: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x2F;&#x2F; updated() &#123;</span><br><span class="line">  &#x2F;&#x2F;   this.showTableTitleDialog();</span><br><span class="line">  &#x2F;&#x2F; &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    chuansuoDialogVisible: function(val) &#123;</span><br><span class="line">      if (val) &#123;</span><br><span class="line">        this.showTableTitleDialog();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    &#x2F;&#x2F; 穿梭框右侧选中改变触发的事件</span><br><span class="line">    rightCheck(selectionKeys, changeKeys) &#123;</span><br><span class="line">      this.tempSelectionKeys &#x3D; selectionKeys;</span><br><span class="line">      if (selectionKeys.length &gt; 0) &#123;</span><br><span class="line">        this.upDisAbled &#x3D; false;</span><br><span class="line">        this.downDisAbled &#x3D; false;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.upDisAbled &#x3D; true;</span><br><span class="line">        this.downDisAbled &#x3D; true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项上移</span><br><span class="line">    handleToUp() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; 0) &#123;</span><br><span class="line">          this.value.splice(indexNum - 1, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum + 1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项下移</span><br><span class="line">    handleToDown() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; -1 &amp;&amp; indexNum !&#x3D;&#x3D; this.value.length - 1) &#123;</span><br><span class="line">          this.value.splice(indexNum + 2, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表头点击取消</span><br><span class="line">    cancleSet() &#123;</span><br><span class="line">      this.value &#x3D; [];</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 显示弹出框穿梭框中的字段</span><br><span class="line">    showTableTitleDialog() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;setFormView&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">            &#x2F;&#x2F; 穿梭框</span><br><span class="line">            const data &#x3D; [];</span><br><span class="line">            const cities &#x3D; res.data.body.allFields;</span><br><span class="line">            cities.forEach((city, index) &#x3D;&gt; &#123;</span><br><span class="line">              data.push(&#123;</span><br><span class="line">                label: city.fieldName,</span><br><span class="line">                key: city.fieldId</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            this.data &#x3D; data;</span><br><span class="line">            for (let i &#x3D; 0; i &lt; res.data.body.needFields.length; i++) &#123;</span><br><span class="line">              this.value.push(res.data.body.needFields[i].fieldId);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表格头显示字段</span><br><span class="line">    setTableTitle() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;editForm&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath,</span><br><span class="line">          fieldIdList: this.value</span><br><span class="line">        &#125;,</span><br><span class="line">        paramsSerializer: (params) &#x3D;&gt; &#123;</span><br><span class="line">          return this.qs.stringify(params, &#123; indices: false &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">            if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">              this.$Message.success(res.data.msg);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$Message.error(res.data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">            this.value.length &#x3D; 0;</span><br><span class="line">            this.$emit(&quot;theadDateReal&quot;, this.theadDateReal.length &#x3D; 0);</span><br><span class="line">            resolve();</span><br><span class="line">          &#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">            this.noShow();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    noShow() &#123;</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false); &#x2F;&#x2F;更新父组件变量</span><br><span class="line">      this.$emit(&quot;tableDataList&quot;);  &#x2F;&#x2F;调用父组件的方法</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;表格设置组件化的具体实现，利用element-ui的穿梭框组件，修改为适用于项目可以调整顺序的组件&lt;/p&gt;
&lt;h2 id=&quot;一、非完美写法&quot;&gt;&lt;a href=&quot;#一、非完美写法&quot; class=&quot;headerlink&quot; title=&quot;一、非完美写法&quot;&gt;&lt;/a&gt;一、非完美写法&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>企业码——JSSDK</title>
    <link href="http://example.com/2022/10/10/%E4%BC%81%E4%B8%9A%E7%A0%81_JSSDK/"/>
    <id>http://example.com/2022/10/10/%E4%BC%81%E4%B8%9A%E7%A0%81_JSSDK/</id>
    <published>2022-10-10T05:56:21.487Z</published>
    <updated>2022-10-10T06:05:57.527Z</updated>
    
    <content type="html"><![CDATA[<p>JSSDK，是在企业码项目中使用，为了统计页面的一个访问量所进行的一个操作，不会跨域名去访问时，具体的实现方法是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;vue在每次离开当前页面进行的一个方法调用</span><br><span class="line">beforeRouteLeave(to, from, next) &#123;</span><br><span class="line">    if (to.name &#x3D;&#x3D;&#x3D; &quot;worktrace&quot;) &#123;</span><br><span class="line">      JSSDK_QYM.sendData(&#123;</span><br><span class="line">        pageUrl: &quot;http:&#x2F;&#x2F;qym.dtsum.com&#x2F;worktrace&quot;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; else if (to.name &#x3D;&#x3D;&#x3D; &quot;carddetail&quot;) &#123;</span><br><span class="line">      JSSDK_QYM.sendData(&#123;</span><br><span class="line">        pageUrl: &quot;http:&#x2F;&#x2F;qym.dtsum.com&#x2F;carddetail&quot;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>离开页面会发送<a href="https://qym.zj.gov.cn/servicePath/accessLog/qymLog%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BB%A3%E8%A1%A8%E8%AE%BE%E7%BD%AE%E6%88%90%E5%8A%9F%E3%80%82">https://qym.zj.gov.cn/servicePath/accessLog/qymLog这个请求代表设置成功。</a></p><p>总结5个入口文件的方法</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;JSSDK，是在企业码项目中使用，为了统计页面的一个访问量所进行的一个操作，不会跨域名去访问时，具体的实现方法是：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>json-serve的使用</title>
    <link href="http://example.com/2021/02/24/json-serve%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2021/02/24/json-serve%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2021-02-24T14:44:44.000Z</published>
    <updated>2021-02-24T14:45:33.486Z</updated>
    
    <content type="html"><![CDATA[<p><strong>一、安装json-serve</strong></p><p>1.npm install -g json-server</p><p>如果报错：<a href="https://www.cnblogs.com/xscn1230/p/nuonuo1230.html">Hostname/IP does not match certificate’s altnames: Host: registry.cnpmjs.org. is not in the cert’s altnames: DNS:r.cnpmjs.org</a></p><p>解决办法：<strong>npm set strict-ssl false</strong></p><p>2.json-server -v</p><p>3.新建文件夹/serve/data.json,在data.json中添加json数据<strong>，如下：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;    </span><br><span class="line">        <span class="attr">&quot;success&quot;</span>: <span class="number">1</span>,   </span><br><span class="line">        <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功！&quot;</span>,    </span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: &#123;      </span><br><span class="line">            <span class="attr">&quot;deviceStateList&quot;</span>: [  </span><br><span class="line">                [        </span><br><span class="line">                    &#123;      </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,      </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,        </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;1&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;运行&quot;</span>       </span><br><span class="line">                    &#125;,        </span><br><span class="line">                    &#123;         </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;2&quot;</span>,        </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;故障停机&quot;</span>  </span><br><span class="line">                    &#125;      </span><br><span class="line">                ],  </span><br><span class="line">                [     </span><br><span class="line">                    &#123;     </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,   </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;1&quot;</span>,       </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;运行&quot;</span> </span><br><span class="line">                    &#125;,      </span><br><span class="line">                    &#123;        </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,        </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,      </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;2&quot;</span>,         </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;故障停机&quot;</span>      </span><br><span class="line">                    &#125;       </span><br><span class="line">                ]     </span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.运行（cmd）</p><p>﻿json-server data.json</p><p><strong>Tips</strong>:json-server –watch data.json   实时监听data.json的变化</p><p><strong>二、在vue中使用json-server</strong></p><p>1.根目录下创建data.json</p><p>2.在package.json中的scripts中配置</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;json&quot;: &quot;json-server data.json --port 3003&quot;</span><br></pre></td></tr></table></figure><p>﻿3.npm run json运行</p><p>4.访问<a href="http://localhost:3003/data">http://localhost:3003/data</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;一、安装json-serve&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1.npm install -g json-server&lt;/p&gt;
&lt;p&gt;如果报错：&lt;a href=&quot;https://www.cnblogs.com/xscn1230/p/nuonuo1230.ht</summary>
      
    
    
    
    <category term="data" scheme="http://example.com/categories/data/"/>
    
    
  </entry>
  
  <entry>
    <title>小程序打印</title>
    <link href="http://example.com/2021/02/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%89%93%E5%8D%B0/"/>
    <id>http://example.com/2021/02/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%89%93%E5%8D%B0/</id>
    <published>2021-02-24T13:29:19.000Z</published>
    <updated>2021-03-01T03:11:25.546Z</updated>
    
    <content type="html"><![CDATA[<h3 id="小程序打印的示例"><a href="#小程序打印的示例" class="headerlink" title="小程序打印的示例"></a>小程序打印的示例</h3><p>需求是小程序通过蓝牙连接打印所需要的的东西，具体实现主要包括两步：</p><p>1.蓝牙连接</p><p>2.打印内容</p><p>具体实现方法如下：</p><p>1.蓝牙连接：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/pack/bleConnect/bleConnect.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&#x27;button&#x27;</span>  <span class="attr">hover-class</span>=<span class="string">&quot;hover&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;startSearch&quot;</span> <span class="attr">loading</span>=<span class="string">&#x27;&#123;&#123;isScanning&#125;&#125;&#x27;</span>&gt;</span> 搜索蓝牙设备 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;.td&quot;</span>&gt;</span>（Android8.0+系统需开启定位）<span class="tag">&lt;/<span class="name">text</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;device_list&quot;</span> <span class="attr">scroll-y</span> <span class="attr">scroll-with-animation</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>  <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;list&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;item&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">data-title</span>=<span class="string">&quot;&#123;&#123;item.deviceId&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">data-name</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">data-advertisData</span>=<span class="string">&quot;&#123;&#123;item.advertisServiceUUIDs&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">wx:key</span>=<span class="string">&quot;deviceId&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">bindtap</span>=<span class="string">&quot;bindViewTap&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;item_hover&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">view</span>  <span class="attr">style</span>=<span class="string">&quot;font-size: 16px; color: #333;&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">view</span>  <span class="attr">style</span>=<span class="string">&quot;font-size: 16px; color: #333;&quot;</span> &gt;</span>&#123;&#123;item.deviceId&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px&quot;</span>&gt;</span>信号强度: &#123;&#123;item.RSSI&#125;&#125;dBm (&#123;&#123;utils.max(0, item.RSSI + 100)&#125;&#125;%)<span class="tag">&lt;/<span class="name">view</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/pack/bleConnect/bleConnect.wxss */</span></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#54bec2</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">98</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: bg_red;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 按下变颜色 */</span></span><br><span class="line"><span class="selector-class">.hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>:  <span class="number">#DCDCDC</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.device_list</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#EEE</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.td</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">   <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line"> <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#EEE</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item_hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.block</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">color</span>:<span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;<span class="comment">/* pages/bleConnect/bleConnect.wxss */</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/pack/bleConnect/bleConnect.js</span></span><br><span class="line"><span class="keyword">var</span> app = getApp()</span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    list: [],</span><br><span class="line">    services: [],</span><br><span class="line">    serviceId: <span class="number">0</span>,</span><br><span class="line">    writeCharacter: <span class="literal">false</span>,</span><br><span class="line">    readCharacter: <span class="literal">false</span>,</span><br><span class="line">    notifyCharacter: <span class="literal">false</span>,</span><br><span class="line">    isScanning:<span class="literal">false</span>,</span><br><span class="line">    aypiId:<span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//搜索设备</span></span><br><span class="line">  startSearch: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    wx.openBluetoothAdapter(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        wx.getBluetoothAdapterState(&#123;</span><br><span class="line">          success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;openBluetoothAdapter success&#x27;</span>, res)</span><br><span class="line">            <span class="keyword">if</span> (res.available) &#123;</span><br><span class="line">              <span class="keyword">if</span> (res.discovering) &#123;</span><br><span class="line">                wx.stopBluetoothDevicesDiscovery(&#123;</span><br><span class="line">                  success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(res)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// that.startBluetoothDevicesDiscovery()</span></span><br><span class="line">                that.getBluetoothDevices()</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">// that.checkPemission()</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              wx.showModal(&#123;</span><br><span class="line">                title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">                content: <span class="string">&#x27;本机蓝牙不可用&#x27;</span>,</span><br><span class="line">                showCancel: <span class="literal">false</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        wx.showModal(&#123;</span><br><span class="line">          title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">          content: <span class="string">&#x27;蓝牙初始化失败，请到设置打开蓝牙&#x27;</span>,</span><br><span class="line">          showCancel: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  checkPemission: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">//android 6.0以上需授权地理位置权限</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> platform = app.BLEInformation.platform</span><br><span class="line">    <span class="keyword">if</span> (platform == <span class="string">&quot;ios&quot;</span>) &#123;</span><br><span class="line">      app.globalData.platform = <span class="string">&quot;ios&quot;</span></span><br><span class="line">      that.getBluetoothDevices()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (platform == <span class="string">&quot;android&quot;</span>) &#123;</span><br><span class="line">      app.globalData.platform = <span class="string">&quot;android&quot;</span></span><br><span class="line">      <span class="built_in">console</span>.log(app.getSystem().substring(app.getSystem().length - (app.getSystem().length - <span class="number">8</span>), app.getSystem().length - (app.getSystem().length - <span class="number">8</span>) + <span class="number">1</span>))</span><br><span class="line">      <span class="keyword">if</span> (app.getSystem().substring(app.getSystem().length - (app.getSystem().length - <span class="number">8</span>), app.getSystem().length - (app.getSystem().length - <span class="number">8</span>) + <span class="number">1</span>) &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        wx.getSetting(&#123;</span><br><span class="line">          success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">            <span class="keyword">if</span> (!res.authSetting[<span class="string">&#x27;scope.userLocation&#x27;</span>]) &#123;</span><br><span class="line">              wx.authorize(&#123;</span><br><span class="line">                scope: <span class="string">&#x27;scope.userLocation&#x27;</span>,</span><br><span class="line">                complete: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                  that.getBluetoothDevices()</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              that.getBluetoothDevices()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getBluetoothDevices: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">//获取蓝牙设备信息</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;start search&quot;</span>)</span><br><span class="line">    wx.showLoading(&#123;</span><br><span class="line">      title: <span class="string">&#x27;正在加载&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&#x27;loading&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      isScanning:<span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    wx.startBluetoothDevicesDiscovery(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          wx.getBluetoothDevices(&#123;</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">var</span> devices = []</span><br><span class="line">              <span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; res.devices.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.devices[i].name != <span class="string">&quot;未知设备&quot;</span>) &#123;</span><br><span class="line">                  devices[num] = res.devices[i]</span><br><span class="line">                  num++</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              that.setData(&#123;</span><br><span class="line">                list: devices,</span><br><span class="line">                isScanning:<span class="literal">false</span></span><br><span class="line">              &#125;)</span><br><span class="line">              wx.hideLoading()</span><br><span class="line">              wx.stopPullDownRefresh()</span><br><span class="line">              wx.stopBluetoothDevicesDiscovery(&#123;</span><br><span class="line">                success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                  <span class="built_in">console</span>.log(<span class="string">&quot;停止搜索蓝牙&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;, <span class="number">5000</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindViewTap: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    wx.stopBluetoothDevicesDiscovery(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123; <span class="built_in">console</span>.log(res) &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      serviceId: <span class="number">0</span>,</span><br><span class="line">      writeCharacter: <span class="literal">false</span>,</span><br><span class="line">      readCharacter: <span class="literal">false</span>,</span><br><span class="line">      notifyCharacter: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(e.currentTarget.dataset.title)</span><br><span class="line">    wx.showLoading(&#123;</span><br><span class="line">      title: <span class="string">&#x27;正在连接&#x27;</span>,</span><br><span class="line">      </span><br><span class="line">    &#125;)</span><br><span class="line">    wx.createBLEConnection(&#123;</span><br><span class="line">      deviceId: e.currentTarget.dataset.title,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        app.BLEInformation.deviceId = e.currentTarget.dataset.title</span><br><span class="line">        that.getSeviceId()</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        wx.showModal(&#123;</span><br><span class="line">          title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">          content: <span class="string">&#x27;连接失败&#x27;</span>,</span><br><span class="line">          showCancel: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">        wx.hideLoading()</span><br><span class="line">      &#125;, <span class="attr">complete</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  getSeviceId: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> platform = app.BLEInformation.platform</span><br><span class="line">    <span class="built_in">console</span>.log(app.BLEInformation.deviceId)</span><br><span class="line">    wx.getBLEDeviceServices(&#123;</span><br><span class="line">      deviceId: app.BLEInformation.deviceId,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          services: res.services</span><br><span class="line">        &#125;)</span><br><span class="line">        that.getCharacteristics()</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;, <span class="attr">complete</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  getCharacteristics: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> list = that.data.services</span><br><span class="line">    <span class="keyword">var</span> num = that.data.serviceId</span><br><span class="line">    <span class="keyword">var</span> write = that.data.writeCharacter</span><br><span class="line">    <span class="keyword">var</span> read = that.data.readCharacter</span><br><span class="line">    <span class="keyword">var</span> notify = that.data.notifyCharacter</span><br><span class="line">    wx.getBLEDeviceCharacteristics(&#123;</span><br><span class="line">      deviceId: app.BLEInformation.deviceId,</span><br><span class="line">      serviceId: list[num].uuid,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; res.characteristics.length; ++i) &#123;</span><br><span class="line">          <span class="keyword">var</span> properties = res.characteristics[i].properties</span><br><span class="line">          <span class="keyword">var</span> item = res.characteristics[i].uuid</span><br><span class="line">          <span class="keyword">if</span> (!notify) &#123;</span><br><span class="line">            <span class="keyword">if</span> (properties.notify) &#123;</span><br><span class="line">              app.BLEInformation.notifyCharaterId = item</span><br><span class="line">              app.BLEInformation.notifyServiceId = list[num].uuid</span><br><span class="line">              notify = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!write) &#123;</span><br><span class="line">            <span class="keyword">if</span> (properties.write) &#123;</span><br><span class="line">              app.BLEInformation.writeCharaterId = item</span><br><span class="line">              app.BLEInformation.writeServiceId = list[num].uuid</span><br><span class="line">              write = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!read) &#123;</span><br><span class="line">            <span class="keyword">if</span> (properties.read) &#123;</span><br><span class="line">              app.BLEInformation.readCharaterId = item</span><br><span class="line">              app.BLEInformation.readServiceId = list[num].uuid</span><br><span class="line">              read = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!write || !notify || !read) &#123;</span><br><span class="line">          num++</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            writeCharacter: write,</span><br><span class="line">            readCharacter: read,</span><br><span class="line">            notifyCharacter: notify,</span><br><span class="line">            serviceId: num</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">if</span> (num == list.length) &#123;</span><br><span class="line">            wx.showModal(&#123;</span><br><span class="line">              title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">              content: <span class="string">&#x27;找不到该读写的特征值&#x27;</span>,</span><br><span class="line">              showCancel: <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            that.getCharacteristics()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          wx.showToast(&#123;</span><br><span class="line">            title: <span class="string">&#x27;连接成功&#x27;</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">          that.openControl()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;, <span class="attr">complete</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;write:&quot;</span> + app.BLEInformation.writeCharaterId)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;read:&quot;</span> + app.BLEInformation.readCharaterId)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;notify:&quot;</span> + app.BLEInformation.notifyCharaterId)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">   openControl: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">//连接成功返回主页</span></span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">&#x27;/pages/pack/previewPrint/previewPrint?aypId=&#x27;</span>+that.data.aypiId,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    that.setData(&#123;<span class="attr">aypiId</span>:options.aypiId&#125;)</span><br><span class="line">    app.BLEInformation.platform = app.getPlatform()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面初次渲染完成</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面显示</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面隐藏</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onHide: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面卸载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onUnload: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面上拉触底事件的处理函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReachBottom: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用户点击右上角分享</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShareAppMessage: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>2.打印（蓝牙连接成功后跳转到打印页面）</p><p>该打印功能直接写在js代码中，无预览功能，只能通过精确计算得出具体的位置，所以预览功能要单独再页面中写出来，项目打印中有条形码，条形码是在一个canvans画板中画出来的，所以当打印的东西也写在画板中时（原来的思路），就会有两个画板，这样二者无法融合，所以通过另外一种方法实现。打印需求是可以自己选择要打印的内容，可以通过勾选框实现，然后遍历checked是true的几项，就是勾选的要打印的。</p><p>注意：该项目有用到两个相关的文件util和tsc，tsc中提供了打印内容调用的方法，util主要是barCode的使用，两个文件可以在以下地址查看</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/pack/previewPrint/previewPrint.js</span></span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;../../../utils/util&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"><span class="keyword">const</span> tsc = <span class="built_in">require</span>(<span class="string">&#x27;../../../utils/tsc.js&#x27;</span>)</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;../../../utils/moment.min.js&#x27;</span></span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    blueToothConnect: <span class="literal">false</span>, <span class="comment">//蓝牙连接是否可用</span></span><br><span class="line">    aypId: <span class="number">1</span>,<span class="comment">//包装表ID</span></span><br><span class="line">    list: [],</span><br><span class="line">    printDate: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    allChecked:<span class="literal">true</span>,</span><br><span class="line">    canvasWidth: <span class="number">347</span>,</span><br><span class="line">    canvasHeight: <span class="number">326</span>,</span><br><span class="line">    oneTimeData: <span class="number">120</span>,</span><br><span class="line">    currentTime: <span class="number">1</span>,</span><br><span class="line">    looptime: <span class="number">0</span>,</span><br><span class="line">    currentPrint: <span class="number">1</span>,</span><br><span class="line">    lastData: <span class="number">0</span>,</span><br><span class="line">    printerNum: <span class="number">1</span>,</span><br><span class="line">    BLEInformation: app.BLEInformation</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//code转化为条形码</span></span><br><span class="line">  <span class="function"><span class="title">handleCreateBarCode</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.data.list.length &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.data.list.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        util.barcode(item.barCode, item.barCode, <span class="number">622</span>, <span class="number">180</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//动态获取要打印的数据内容</span></span><br><span class="line">  <span class="function"><span class="title">getList</span>(<span class="params">callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: getApp().baseUrl + <span class="string">&#x27;/iext/back/applets/PackageController/searchPackageInfo&#x27;</span>,</span><br><span class="line">      method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      header: &#123;</span><br><span class="line">        Cookie: wx.getStorageSync(<span class="string">&#x27;sessionid&#x27;</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        aypId: that.data.aypId</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.data.success === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> date = moment(<span class="keyword">new</span> <span class="built_in">Date</span>()).format(<span class="string">&#x27;YYYY-MM-DD  HH:mm&#x27;</span>)</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; res.data.body.weightList.length; i++) &#123;</span><br><span class="line">            res.data.body.weightList[i].checked = <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            list: res.data.body.weightList,</span><br><span class="line">            printDate: date</span><br><span class="line">          &#125;)</span><br><span class="line">          callback()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(res.data.msg)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">fail</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.data.msg)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 勾选复选框</span></span><br><span class="line">  <span class="function"><span class="title">onChangeCheck</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">const</span> newList = that.data.list</span><br><span class="line">    newList[e.currentTarget.dataset.index].checked = !newList[e.currentTarget.dataset.index].checked</span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      list: newList</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; that.data.list.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span>(that.data.list[i].checked===<span class="literal">false</span>)&#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          allChecked: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> result=that.data.list.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.checked===<span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span>(result.length===<span class="number">0</span>)&#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          allChecked: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 全选复选框</span></span><br><span class="line">  <span class="function"><span class="title">onChangeAllCheck</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      allChecked:!that.data.allChecked</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(that.data.allChecked)&#123;</span><br><span class="line">      <span class="keyword">const</span> newList=that.data.list</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newList.length; i++) &#123;</span><br><span class="line">        newList[i].checked=<span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        list:newList</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> newList=that.data.list</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newList.length; i++) &#123;</span><br><span class="line">        newList[i].checked=<span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        list:newList</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//页面中点击打印调用此方法</span></span><br><span class="line">  printPhoto: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">//打印bitmap，图片内容不建议太大，小程序限制传输的字节数为20byte</span></span><br><span class="line">   <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">    <span class="comment">//查看蓝牙连接是否可用</span></span><br><span class="line">    <span class="keyword">if</span> (that.data.blueToothConnect === <span class="literal">false</span>) &#123;</span><br><span class="line">      wx.navigateTo(&#123;</span><br><span class="line">        url: <span class="string">&#x27;../bleConnect/bleConnect?aypiId=&#x27;</span> + that.data.list[<span class="number">0</span>].aypiId</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; that.data.list.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> list = that.data.list[i]</span><br><span class="line">        <span class="keyword">if</span> (list.checked === <span class="literal">false</span>) &#123;</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            that.realPrint(list)</span><br><span class="line">          &#125;, <span class="number">5000</span> * i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//构建打印的内容和样式</span></span><br><span class="line">  realPrint:<span class="function"><span class="keyword">function</span>(<span class="params">list</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> command = tsc.jpPrinter.createNew()</span><br><span class="line">    command.setCls()<span class="comment">//清除缓冲区，防止下一个没生效</span></span><br><span class="line">    command.setSize(<span class="number">70</span>, <span class="number">60</span>)<span class="comment">//设置标签大小，单位mm.具体参数请用尺子量一下</span></span><br><span class="line">    command.setGap(<span class="number">0</span>)<span class="comment">//设置两个标签之间的间隙，单位mm.具体参数请用尺子量一下</span></span><br><span class="line">    command.setCls()<span class="comment">//清除缓冲区</span></span><br><span class="line">    command.setBar(<span class="number">10</span>, <span class="number">75</span>, <span class="number">500</span>, <span class="number">3</span>);<span class="comment">//绘制一条黑线</span></span><br><span class="line">    command.setText(<span class="number">105</span>, <span class="number">20</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="string">&quot;包装流转信息卡&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;订单单号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">140</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.orderNumber)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">340</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;箱    号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">450</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.aypAyciNum)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;工单单号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">140</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.workOrderNumber)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">340</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;机 台 号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">450</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.deviceNumber)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">200</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;规    格：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    <span class="keyword">const</span> str = list.standards</span><br><span class="line">    <span class="keyword">if</span> (str.length &gt; <span class="number">25</span>) &#123;</span><br><span class="line">      command.setText(<span class="number">140</span>, <span class="number">200</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, str.slice(<span class="number">0</span>, <span class="number">26</span>))<span class="comment">//绘制文字</span></span><br><span class="line">      command.setText(<span class="number">140</span>, <span class="number">240</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, str.slice(<span class="number">26</span>, str.length))<span class="comment">//绘制文字</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      command.setText(<span class="number">140</span>, <span class="number">200</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, str)<span class="comment">//绘制文字</span></span><br><span class="line">    &#125;</span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">280</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;净    重：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">140</span>, <span class="number">280</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.netWeight + <span class="string">&#x27;kg&#x27;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">300</span>, <span class="number">280</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, that.data.printDate)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setBarCode(<span class="number">30</span>, <span class="number">330</span>, <span class="string">&quot;128&quot;</span>, <span class="number">110</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">3</span>, list.barCode)<span class="comment">//绘制code128条码</span></span><br><span class="line">    command.setText(<span class="number">150</span>, <span class="number">440</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.barCode)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setPagePrint()<span class="comment">//执行打印指令</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      isLabelSend: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    that.prepareSend(command.getData())</span><br><span class="line">  &#125;,</span><br><span class="line">  prepareSend: <span class="function"><span class="keyword">function</span> (<span class="params">buff</span>) </span>&#123; <span class="comment">//准备发送，根据每次发送字节数来处理分包数量</span></span><br><span class="line">    <span class="comment">//console.log(buff)</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> time = that.data.oneTimeData</span><br><span class="line">    <span class="keyword">var</span> looptime = <span class="built_in">parseInt</span>(buff.length / time);</span><br><span class="line">    <span class="keyword">var</span> lastData = <span class="built_in">parseInt</span>(buff.length % time);</span><br><span class="line">    <span class="comment">//console.log(looptime + &quot;---&quot; + lastData)</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      looptime: looptime + <span class="number">1</span>,</span><br><span class="line">      lastData: lastData,</span><br><span class="line">      currentTime: <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(buff)</span><br><span class="line">    that.Send(buff)</span><br><span class="line">  &#125;,</span><br><span class="line">  Send: <span class="function"><span class="keyword">function</span> (<span class="params">buff</span>) </span>&#123; <span class="comment">//分包发送</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> currentTime = that.data.currentTime</span><br><span class="line">    <span class="keyword">var</span> loopTime = that.data.looptime</span><br><span class="line">    <span class="keyword">var</span> lastData = that.data.lastData</span><br><span class="line">    <span class="keyword">var</span> onTimeData = that.data.oneTimeData</span><br><span class="line">    <span class="keyword">var</span> printNum = that.data.printerNum</span><br><span class="line">    <span class="keyword">var</span> currentPrint = that.data.currentPrint</span><br><span class="line">    <span class="keyword">var</span> buf</span><br><span class="line">    <span class="keyword">var</span> dataView</span><br><span class="line">    <span class="keyword">if</span> (currentTime &lt; loopTime) &#123;</span><br><span class="line">      buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(onTimeData)</span><br><span class="line">      dataView = <span class="keyword">new</span> <span class="built_in">DataView</span>(buf)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; onTimeData; ++i) &#123;</span><br><span class="line">        dataView.setUint8(i, buff[(currentTime - <span class="number">1</span>) * onTimeData + i])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(lastData)</span><br><span class="line">      dataView = <span class="keyword">new</span> <span class="built_in">DataView</span>(buf)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; lastData; ++i) &#123;</span><br><span class="line">        dataView.setUint8(i, buff[(currentTime - <span class="number">1</span>) * onTimeData + i])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//console.log(&quot;第&quot; + currentTime + &quot;次发送数据大小为：&quot; + buf.byteLength)</span></span><br><span class="line">    wx.writeBLECharacteristicValue(&#123;</span><br><span class="line">      deviceId: app.BLEInformation.deviceId,</span><br><span class="line">      serviceId: app.BLEInformation.writeServiceId,</span><br><span class="line">      characteristicId: app.BLEInformation.writeCharaterId,</span><br><span class="line">      value: buf,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentPrint == printNum) &#123;</span><br><span class="line">          wx.showToast(&#123;</span><br><span class="line">            title: <span class="string">&#x27;已打印第&#x27;</span> + currentPrint + <span class="string">&#x27;张成功&#x27;</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//console.log(res)</span></span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          title: <span class="string">&#x27;打印第&#x27;</span> + currentPrint + <span class="string">&#x27;张失败&#x27;</span>,</span><br><span class="line">          icon: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//console.log(e)</span></span><br><span class="line">      &#125;,</span><br><span class="line">      complete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        currentTime++</span><br><span class="line">        <span class="keyword">if</span> (currentTime &lt;= loopTime) &#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            currentTime: currentTime</span><br><span class="line">          &#125;)</span><br><span class="line">          that.Send(buff)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// wx.showToast(&#123;</span></span><br><span class="line">          <span class="comment">//   title: &#x27;已打印第&#x27; + currentPrint + &#x27;张&#x27;,</span></span><br><span class="line">          <span class="comment">// &#125;)`</span></span><br><span class="line">          <span class="keyword">if</span> (currentPrint == printNum) &#123;</span><br><span class="line">            that.setData(&#123;</span><br><span class="line">              looptime: <span class="number">0</span>,</span><br><span class="line">              lastData: <span class="number">0</span>,</span><br><span class="line">              currentTime: <span class="number">1</span>,</span><br><span class="line">              isLabelSend: <span class="literal">false</span>,</span><br><span class="line">              currentPrint: <span class="number">1</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            currentPrint++</span><br><span class="line">            that.setData(&#123;</span><br><span class="line">              currentPrint: currentPrint,</span><br><span class="line">              currentTime: <span class="number">1</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">            that.Send(buff)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      aypId: options.aypId</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面初次渲染完成</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="comment">// 获取蓝牙设备状态是否可用</span></span><br><span class="line">    wx.getBluetoothAdapterState(&#123;</span><br><span class="line">      <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.available === <span class="literal">true</span>) &#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">false</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="function"><span class="title">fail</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err.errCode!==<span class="number">0</span>&amp;&amp;err.errCode!==-<span class="number">1</span>)&#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">false</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 监听蓝牙设备状态是否可用</span></span><br><span class="line">    wx.onBluetoothAdapterStateChange(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (res.available === <span class="literal">true</span>) &#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          blueToothConnect: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          blueToothConnect: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面显示</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.getList(<span class="built_in">this</span>.handleCreateBarCode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获得上一个页面中的路由</span><br><span class="line">   var that &#x3D; this;</span><br><span class="line">   let pages &#x3D; getCurrentPages();</span><br><span class="line">   let currPage &#x3D; null;</span><br><span class="line">   if (pages.length) &#123;</span><br><span class="line">     currPage &#x3D; pages[pages.length - 2];</span><br><span class="line">   &#125;</span><br><span class="line">   let route &#x3D; currPage.route</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;小程序打印的示例&quot;&gt;&lt;a href=&quot;#小程序打印的示例&quot; class=&quot;headerlink&quot; title=&quot;小程序打印的示例&quot;&gt;&lt;/a&gt;小程序打印的示例&lt;/h3&gt;&lt;p&gt;需求是小程序通过蓝牙连接打印所需要的的东西，具体实现主要包括两步：&lt;/p&gt;
&lt;p&gt;1.蓝牙连</summary>
      
    
    
    
    <category term="小程序" scheme="http://example.com/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2021/01/01/hello-world/"/>
    <id>http://example.com/2021/01/01/hello-world/</id>
    <published>2021-01-01T11:05:19.264Z</published>
    <updated>2021-01-01T11:05:19.264Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
