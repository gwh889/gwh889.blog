<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>个人学习博客</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-10-10T08:41:37.701Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>GWH</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>表格组件化</title>
    <link href="http://example.com/2022/10/10/%E8%A1%A8%E6%A0%BC%E8%AE%BE%E7%BD%AE%E7%BB%84%E4%BB%B6%E5%8C%96/"/>
    <id>http://example.com/2022/10/10/%E8%A1%A8%E6%A0%BC%E8%AE%BE%E7%BD%AE%E7%BB%84%E4%BB%B6%E5%8C%96/</id>
    <published>2022-10-10T05:56:21.490Z</published>
    <updated>2022-10-10T08:41:37.701Z</updated>
    
    <content type="html"><![CDATA[<p>表格设置组件化的具体实现，利用element-ui的穿梭框组件，修改为适用于项目可以调整顺序的组件</p><h2 id="一、非完美写法"><a href="#一、非完美写法" class="headerlink" title="一、非完美写法"></a>一、非完美写法</h2><p>表格设置组件的使用，主要是在父组件需要按照一下规矩定义：</p><h3 id="父组件："><a href="#父组件：" class="headerlink" title="父组件："></a>父组件：</h3><p>1.引入表格设置的子组件并注册：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import TableSetting from &quot;..&#x2F;..&#x2F;components&#x2F;home&#x2F;tableSetting.vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">   components: &#123;</span><br><span class="line">    TableSetting</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.在页面中使用组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 穿梭框的弹出框 --&gt;</span><br><span class="line">&lt;TableSetting</span><br><span class="line">      :routerPath&#x3D;&quot;routerPath&quot;</span><br><span class="line">      :theadDateReal&#x3D;&quot;bindTheadDateReal&quot;</span><br><span class="line">      @getTableDataList&#x3D;&quot;bindTableDataList&quot;</span><br><span class="line">      :chuansuoDialogVisible.sync&#x3D;&quot;chuansuoDialogVisible&quot;</span><br><span class="line">&gt;&lt;&#x2F;TableSetting&gt;</span><br></pre></td></tr></table></figure><p>3.声明要进行表格设置的变量routerPath和iview表格中的表格数据theadDateReal，子组件中会用到（当页面存在两个表格设置时如下，一个时只留前两个）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      routerPath: &quot;&quot;, &#x2F;&#x2F;需要进行表格设置的表格接口api</span><br><span class="line">      bindTheadDateReal: [], &#x2F;&#x2F;真正表格绑定的表格头</span><br><span class="line">      bindTableDataList: [], &#x2F;&#x2F;表格的数据</span><br><span class="line">      chuansuoDialogVisible: false, &#x2F;&#x2F;弹窗是否显示</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.在方法中声明点击 “表格设置” 会触发的函数（当页面存在多个个表格设置时，可以写多个以下函数，就是赋值的内容变掉）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">showTableTitleDialog() &#123;</span><br><span class="line">      this.routerPath &#x3D;</span><br><span class="line">        &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;material&#x2F;materialController&#x2F;materialOutSearch&quot;;</span><br><span class="line">      this.bindTheadDateReal &#x3D; this.tableRealColumns;</span><br><span class="line">      this.bindTableDataList &#x3D; this.getTableDataList;</span><br><span class="line">      this.chuansuoDialogVisible &#x3D; true;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><h3 id="子组件："><a href="#子组件：" class="headerlink" title="子组件："></a>子组件：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 使用表格设置有一个约定:</span><br><span class="line">    注意：父组件写的时候不要放在引用组件的里边</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 穿梭框的弹出框 --&gt;</span><br><span class="line">    &lt;Modal</span><br><span class="line">      v-model&#x3D;&quot;chuansuoDialogVisible&quot;</span><br><span class="line">      title&#x3D;&quot;表格设置&quot;</span><br><span class="line">      :width&#x3D;&quot;600&quot;</span><br><span class="line">      :closable&#x3D;&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;20&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;chuanSuo&quot;&gt;</span><br><span class="line">            &lt;el-transfer</span><br><span class="line">              filterable</span><br><span class="line">              filter-placeholder&#x3D;&quot;请输入表头名称&quot;</span><br><span class="line">              :titles&#x3D;&quot;[&#39;未选字段&#39;, &#39;已选字段&#39;]&quot;</span><br><span class="line">              v-model&#x3D;&quot;value&quot;</span><br><span class="line">              :data&#x3D;&quot;data&quot;</span><br><span class="line">              target-order&#x3D;&quot;unshirt&quot;</span><br><span class="line">              @right-check-change&#x3D;&quot;rightCheck&quot;</span><br><span class="line">            &gt;&lt;&#x2F;el-transfer&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;4&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-up sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;upDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToUp&quot;</span><br><span class="line">            style&#x3D;&quot;margin-top:110px&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-down sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;downDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToDown&quot;</span><br><span class="line">            style&#x3D;&quot;margin:10px 0&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">      &lt;&#x2F;el-row&gt;</span><br><span class="line">      &lt;div slot&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">        &lt;Button @click&#x3D;&quot;cancleSet&quot;&gt;取 消&lt;&#x2F;Button&gt;</span><br><span class="line">        &lt;Button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;setTableTitle&quot;&gt;确 定&lt;&#x2F;Button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;Modal&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [</span><br><span class="line">    &quot;routerPath&quot;,</span><br><span class="line">    &quot;routerPath1&quot;,</span><br><span class="line">    &quot;chuansuoDialogVisible&quot;,</span><br><span class="line">    &quot;theadDateReal&quot;</span><br><span class="line">  ],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      data: [],</span><br><span class="line">      value: [],</span><br><span class="line">      upDisAbled: true,</span><br><span class="line">      downDisAbled: true,</span><br><span class="line">      tempSelectionKeys: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    chuansuoDialogVisible: function(val) &#123;</span><br><span class="line">      if (val) &#123;</span><br><span class="line">        this.showTableTitleDialog();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    &#x2F;&#x2F; 穿梭框右侧选中改变触发的事件</span><br><span class="line">    rightCheck(selectionKeys, changeKeys) &#123;</span><br><span class="line">      this.tempSelectionKeys &#x3D; selectionKeys;</span><br><span class="line">      if (selectionKeys.length &gt; 0) &#123;</span><br><span class="line">        this.upDisAbled &#x3D; false;</span><br><span class="line">        this.downDisAbled &#x3D; false;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.upDisAbled &#x3D; true;</span><br><span class="line">        this.downDisAbled &#x3D; true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项上移</span><br><span class="line">    handleToUp() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; 0) &#123;</span><br><span class="line">          this.value.splice(indexNum - 1, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum + 1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项下移</span><br><span class="line">    handleToDown() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; -1 &amp;&amp; indexNum !&#x3D;&#x3D; this.value.length - 1) &#123;</span><br><span class="line">          this.value.splice(indexNum + 2, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表头点击取消</span><br><span class="line">    cancleSet() &#123;</span><br><span class="line">      this.value &#x3D; [];</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 显示弹出框穿梭框中的字段</span><br><span class="line">    showTableTitleDialog() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;setFormView&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">            &#x2F;&#x2F; 穿梭框</span><br><span class="line">            const data &#x3D; [];</span><br><span class="line">            const cities &#x3D; res.data.body.allFields;</span><br><span class="line">            cities.forEach((city, index) &#x3D;&gt; &#123;</span><br><span class="line">              data.push(&#123;</span><br><span class="line">                label: city.fieldName,</span><br><span class="line">                key: city.fieldId</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            this.data &#x3D; data;</span><br><span class="line">            for (let i &#x3D; 0; i &lt; res.data.body.needFields.length; i++) &#123;</span><br><span class="line">              this.value.push(res.data.body.needFields[i].fieldId);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表格头显示字段</span><br><span class="line">    setTableTitle() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;editForm&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath,</span><br><span class="line">          fieldIdList: this.value</span><br><span class="line">        &#125;,</span><br><span class="line">        paramsSerializer: (params) &#x3D;&gt; &#123;</span><br><span class="line">          return this.qs.stringify(params, &#123; indices: false &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">            if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">              this.$Message.success(res.data.msg);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$Message.error(res.data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">            this.value.length &#x3D; 0;</span><br><span class="line">            this.$emit(&quot;theadDateReal&quot;, this.theadDateReal.length &#x3D; 0);</span><br><span class="line">            resolve();</span><br><span class="line">          &#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">            this.noShow();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    noShow() &#123;</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false);</span><br><span class="line">      this.$emit(&quot;tableDataList&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="二、较完美写法"><a href="#二、较完美写法" class="headerlink" title="二、较完美写法"></a>二、较完美写法</h2><h3 id="父组件"><a href="#父组件" class="headerlink" title="父组件"></a>父组件</h3><p>1.引入表格设置的子组件并注册</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import TableSetting from &quot;..&#x2F;..&#x2F;components&#x2F;home&#x2F;tableSetting.vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">   components: &#123;</span><br><span class="line">    TableSetting</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.api的定义</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;tableSetting :chuansuoDialogVisible.sync&#x3D;&quot;chuansuoDialogVisible&quot; :routerPath&#x3D;&quot;routerPath&quot; theadDateReal&#x3D;&quot;theadDateReal&quot; tableDataList&#x3D;&quot;tableDataList&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure><p>chuansuoDialogVisible    为是否显示表格设置弹窗</p><p>routerPath             为表格设置所在表格的接口地址</p><p>theadDateReal            为表格的表格头数组变量</p><p>tableDataList            为获取表格信息的函数名</p><h3 id="子组件"><a href="#子组件" class="headerlink" title="子组件"></a>子组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 使用表格设置有一个约定:</span><br><span class="line">    注意：父组件写的时候不要放在引用组件的里边</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 穿梭框的弹出框 --&gt;</span><br><span class="line">    &lt;Modal</span><br><span class="line">      v-model&#x3D;&quot;chuansuoDialogVisible&quot;</span><br><span class="line">      title&#x3D;&quot;表格设置&quot;</span><br><span class="line">      :width&#x3D;&quot;600&quot;</span><br><span class="line">      :closable&#x3D;&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;20&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;chuanSuo&quot;&gt;</span><br><span class="line">            &lt;el-transfer</span><br><span class="line">              filterable</span><br><span class="line">              filter-placeholder&#x3D;&quot;请输入表头名称&quot;</span><br><span class="line">              :titles&#x3D;&quot;[&#39;未选字段&#39;, &#39;已选字段&#39;]&quot;</span><br><span class="line">              v-model&#x3D;&quot;value&quot;</span><br><span class="line">              :data&#x3D;&quot;data&quot;</span><br><span class="line">              target-order&#x3D;&quot;unshirt&quot;</span><br><span class="line">              @right-check-change&#x3D;&quot;rightCheck&quot;</span><br><span class="line">            &gt;&lt;&#x2F;el-transfer&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">        &lt;el-col :span&#x3D;&quot;4&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-up sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;upDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToUp&quot;</span><br><span class="line">            style&#x3D;&quot;margin-top:110px&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            round</span><br><span class="line">            class&#x3D;&quot;el-icon-arrow-down sort_button&quot;</span><br><span class="line">            :disabled&#x3D;&quot;downDisAbled&quot;</span><br><span class="line">            @click&#x3D;&quot;handleToDown&quot;</span><br><span class="line">            style&#x3D;&quot;margin:10px 0&quot;</span><br><span class="line">          &gt;&lt;&#x2F;el-button&gt;</span><br><span class="line">        &lt;&#x2F;el-col&gt;</span><br><span class="line">      &lt;&#x2F;el-row&gt;</span><br><span class="line">      &lt;div slot&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">        &lt;Button @click&#x3D;&quot;cancleSet&quot;&gt;取 消&lt;&#x2F;Button&gt;</span><br><span class="line">        &lt;Button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;setTableTitle&quot;&gt;确 定&lt;&#x2F;Button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;Modal&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [</span><br><span class="line">    &quot;routerPath&quot;,</span><br><span class="line">    &quot;routerPath1&quot;,</span><br><span class="line">    &quot;chuansuoDialogVisible&quot;,</span><br><span class="line">    &quot;theadDateReal&quot;</span><br><span class="line">  ],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      data: [],</span><br><span class="line">      value: [],</span><br><span class="line">      upDisAbled: true,</span><br><span class="line">      downDisAbled: true,</span><br><span class="line">      tempSelectionKeys: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x2F;&#x2F; updated() &#123;</span><br><span class="line">  &#x2F;&#x2F;   this.showTableTitleDialog();</span><br><span class="line">  &#x2F;&#x2F; &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    chuansuoDialogVisible: function(val) &#123;</span><br><span class="line">      if (val) &#123;</span><br><span class="line">        this.showTableTitleDialog();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    &#x2F;&#x2F; 穿梭框右侧选中改变触发的事件</span><br><span class="line">    rightCheck(selectionKeys, changeKeys) &#123;</span><br><span class="line">      this.tempSelectionKeys &#x3D; selectionKeys;</span><br><span class="line">      if (selectionKeys.length &gt; 0) &#123;</span><br><span class="line">        this.upDisAbled &#x3D; false;</span><br><span class="line">        this.downDisAbled &#x3D; false;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.upDisAbled &#x3D; true;</span><br><span class="line">        this.downDisAbled &#x3D; true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项上移</span><br><span class="line">    handleToUp() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; 0) &#123;</span><br><span class="line">          this.value.splice(indexNum - 1, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum + 1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 选项下移</span><br><span class="line">    handleToDown() &#123;</span><br><span class="line">      if (this.tempSelectionKeys.length &gt; 1) &#123;</span><br><span class="line">        this.$Message.warning(&quot;仅支持单选调顺序&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      let indexNum &#x3D; 0;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; this.tempSelectionKeys.length; i++) &#123;</span><br><span class="line">        indexNum &#x3D; this.value.indexOf(this.tempSelectionKeys[i]);</span><br><span class="line">        if (indexNum &gt; -1 &amp;&amp; indexNum !&#x3D;&#x3D; this.value.length - 1) &#123;</span><br><span class="line">          this.value.splice(indexNum + 2, 0, this.tempSelectionKeys[i]);</span><br><span class="line">          this.value.splice(indexNum, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表头点击取消</span><br><span class="line">    cancleSet() &#123;</span><br><span class="line">      this.value &#x3D; [];</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 显示弹出框穿梭框中的字段</span><br><span class="line">    showTableTitleDialog() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;setFormView&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">            &#x2F;&#x2F; 穿梭框</span><br><span class="line">            const data &#x3D; [];</span><br><span class="line">            const cities &#x3D; res.data.body.allFields;</span><br><span class="line">            cities.forEach((city, index) &#x3D;&gt; &#123;</span><br><span class="line">              data.push(&#123;</span><br><span class="line">                label: city.fieldName,</span><br><span class="line">                key: city.fieldId</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            this.data &#x3D; data;</span><br><span class="line">            for (let i &#x3D; 0; i &lt; res.data.body.needFields.length; i++) &#123;</span><br><span class="line">              this.value.push(res.data.body.needFields[i].fieldId);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置表格头显示字段</span><br><span class="line">    setTableTitle() &#123;</span><br><span class="line">      this.axios(&#123;</span><br><span class="line">        url: &quot;&#x2F;dtsum&#x2F;zongtong&#x2F;basic&#x2F;CommonController&#x2F;editForm&quot;,</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: &#123;</span><br><span class="line">          router: this.routerPath,</span><br><span class="line">          fieldIdList: this.value</span><br><span class="line">        &#125;,</span><br><span class="line">        paramsSerializer: (params) &#x3D;&gt; &#123;</span><br><span class="line">          return this.qs.stringify(params, &#123; indices: false &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((res) &#x3D;&gt; &#123;</span><br><span class="line">          new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">            if (res.data.success &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">              this.$Message.success(res.data.msg);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$Message.error(res.data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">            this.value.length &#x3D; 0;</span><br><span class="line">            this.$emit(&quot;theadDateReal&quot;, this.theadDateReal.length &#x3D; 0);</span><br><span class="line">            resolve();</span><br><span class="line">          &#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">            this.noShow();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) &#x3D;&gt; &#123;</span><br><span class="line">          console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    noShow() &#123;</span><br><span class="line">      this.$emit(&quot;update:chuansuoDialogVisible&quot;, false); &#x2F;&#x2F;更新父组件变量</span><br><span class="line">      this.$emit(&quot;tableDataList&quot;);  &#x2F;&#x2F;调用父组件的方法</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;表格设置组件化的具体实现，利用element-ui的穿梭框组件，修改为适用于项目可以调整顺序的组件&lt;/p&gt;
&lt;h2 id=&quot;一、非完美写法&quot;&gt;&lt;a href=&quot;#一、非完美写法&quot; class=&quot;headerlink&quot; title=&quot;一、非完美写法&quot;&gt;&lt;/a&gt;一、非完美写法&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>企业码——JSSDK</title>
    <link href="http://example.com/2022/10/10/%E4%BC%81%E4%B8%9A%E7%A0%81_JSSDK/"/>
    <id>http://example.com/2022/10/10/%E4%BC%81%E4%B8%9A%E7%A0%81_JSSDK/</id>
    <published>2022-10-10T05:56:21.487Z</published>
    <updated>2022-10-10T06:05:57.527Z</updated>
    
    <content type="html"><![CDATA[<p>JSSDK，是在企业码项目中使用，为了统计页面的一个访问量所进行的一个操作，不会跨域名去访问时，具体的实现方法是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;vue在每次离开当前页面进行的一个方法调用</span><br><span class="line">beforeRouteLeave(to, from, next) &#123;</span><br><span class="line">    if (to.name &#x3D;&#x3D;&#x3D; &quot;worktrace&quot;) &#123;</span><br><span class="line">      JSSDK_QYM.sendData(&#123;</span><br><span class="line">        pageUrl: &quot;http:&#x2F;&#x2F;qym.dtsum.com&#x2F;worktrace&quot;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; else if (to.name &#x3D;&#x3D;&#x3D; &quot;carddetail&quot;) &#123;</span><br><span class="line">      JSSDK_QYM.sendData(&#123;</span><br><span class="line">        pageUrl: &quot;http:&#x2F;&#x2F;qym.dtsum.com&#x2F;carddetail&quot;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>离开页面会发送<a href="https://qym.zj.gov.cn/servicePath/accessLog/qymLog%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BB%A3%E8%A1%A8%E8%AE%BE%E7%BD%AE%E6%88%90%E5%8A%9F%E3%80%82">https://qym.zj.gov.cn/servicePath/accessLog/qymLog这个请求代表设置成功。</a></p><p>总结5个入口文件的方法</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;JSSDK，是在企业码项目中使用，为了统计页面的一个访问量所进行的一个操作，不会跨域名去访问时，具体的实现方法是：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>json-serve的使用</title>
    <link href="http://example.com/2021/02/24/json-serve%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2021/02/24/json-serve%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2021-02-24T14:44:44.000Z</published>
    <updated>2021-02-24T14:45:33.486Z</updated>
    
    <content type="html"><![CDATA[<p><strong>一、安装json-serve</strong></p><p>1.npm install -g json-server</p><p>如果报错：<a href="https://www.cnblogs.com/xscn1230/p/nuonuo1230.html">Hostname/IP does not match certificate’s altnames: Host: registry.cnpmjs.org. is not in the cert’s altnames: DNS:r.cnpmjs.org</a></p><p>解决办法：<strong>npm set strict-ssl false</strong></p><p>2.json-server -v</p><p>3.新建文件夹/serve/data.json,在data.json中添加json数据<strong>，如下：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;    </span><br><span class="line">        <span class="attr">&quot;success&quot;</span>: <span class="number">1</span>,   </span><br><span class="line">        <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功！&quot;</span>,    </span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: &#123;      </span><br><span class="line">            <span class="attr">&quot;deviceStateList&quot;</span>: [  </span><br><span class="line">                [        </span><br><span class="line">                    &#123;      </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,      </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,        </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;1&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;运行&quot;</span>       </span><br><span class="line">                    &#125;,        </span><br><span class="line">                    &#123;         </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;2&quot;</span>,        </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;故障停机&quot;</span>  </span><br><span class="line">                    &#125;      </span><br><span class="line">                ],  </span><br><span class="line">                [     </span><br><span class="line">                    &#123;     </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,   </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,          </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;1&quot;</span>,       </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;运行&quot;</span> </span><br><span class="line">                    &#125;,      </span><br><span class="line">                    &#123;        </span><br><span class="line">                        <span class="attr">&quot;statusTime&quot;</span>: <span class="string">&quot;2020-8-21 12:58:35&quot;</span>,        </span><br><span class="line">                        <span class="attr">&quot;duration&quot;</span>: <span class="string">&quot;&quot;</span>,      </span><br><span class="line">                        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;2&quot;</span>,         </span><br><span class="line">                        <span class="attr">&quot;statusName&quot;</span>: <span class="string">&quot;故障停机&quot;</span>      </span><br><span class="line">                    &#125;       </span><br><span class="line">                ]     </span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.运行（cmd）</p><p>﻿json-server data.json</p><p><strong>Tips</strong>:json-server –watch data.json   实时监听data.json的变化</p><p><strong>二、在vue中使用json-server</strong></p><p>1.根目录下创建data.json</p><p>2.在package.json中的scripts中配置</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;json&quot;: &quot;json-server data.json --port 3003&quot;</span><br></pre></td></tr></table></figure><p>﻿3.npm run json运行</p><p>4.访问<a href="http://localhost:3003/data">http://localhost:3003/data</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;一、安装json-serve&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1.npm install -g json-server&lt;/p&gt;
&lt;p&gt;如果报错：&lt;a href=&quot;https://www.cnblogs.com/xscn1230/p/nuonuo1230.ht</summary>
      
    
    
    
    <category term="data" scheme="http://example.com/categories/data/"/>
    
    
  </entry>
  
  <entry>
    <title>小程序打印</title>
    <link href="http://example.com/2021/02/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%89%93%E5%8D%B0/"/>
    <id>http://example.com/2021/02/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%89%93%E5%8D%B0/</id>
    <published>2021-02-24T13:29:19.000Z</published>
    <updated>2021-03-01T03:11:25.546Z</updated>
    
    <content type="html"><![CDATA[<h3 id="小程序打印的示例"><a href="#小程序打印的示例" class="headerlink" title="小程序打印的示例"></a>小程序打印的示例</h3><p>需求是小程序通过蓝牙连接打印所需要的的东西，具体实现主要包括两步：</p><p>1.蓝牙连接</p><p>2.打印内容</p><p>具体实现方法如下：</p><p>1.蓝牙连接：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/pack/bleConnect/bleConnect.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&#x27;button&#x27;</span>  <span class="attr">hover-class</span>=<span class="string">&quot;hover&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;startSearch&quot;</span> <span class="attr">loading</span>=<span class="string">&#x27;&#123;&#123;isScanning&#125;&#125;&#x27;</span>&gt;</span> 搜索蓝牙设备 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;.td&quot;</span>&gt;</span>（Android8.0+系统需开启定位）<span class="tag">&lt;/<span class="name">text</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;device_list&quot;</span> <span class="attr">scroll-y</span> <span class="attr">scroll-with-animation</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>  <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;list&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;item&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">data-title</span>=<span class="string">&quot;&#123;&#123;item.deviceId&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">data-name</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">data-advertisData</span>=<span class="string">&quot;&#123;&#123;item.advertisServiceUUIDs&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">wx:key</span>=<span class="string">&quot;deviceId&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">bindtap</span>=<span class="string">&quot;bindViewTap&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;item_hover&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">view</span>  <span class="attr">style</span>=<span class="string">&quot;font-size: 16px; color: #333;&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">view</span>  <span class="attr">style</span>=<span class="string">&quot;font-size: 16px; color: #333;&quot;</span> &gt;</span>&#123;&#123;item.deviceId&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px&quot;</span>&gt;</span>信号强度: &#123;&#123;item.RSSI&#125;&#125;dBm (&#123;&#123;utils.max(0, item.RSSI + 100)&#125;&#125;%)<span class="tag">&lt;/<span class="name">view</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/pack/bleConnect/bleConnect.wxss */</span></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#54bec2</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">98</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: bg_red;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 按下变颜色 */</span></span><br><span class="line"><span class="selector-class">.hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>:  <span class="number">#DCDCDC</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.device_list</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#EEE</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.td</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">   <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line"> <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#EEE</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item_hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.block</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">color</span>:<span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;<span class="comment">/* pages/bleConnect/bleConnect.wxss */</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/pack/bleConnect/bleConnect.js</span></span><br><span class="line"><span class="keyword">var</span> app = getApp()</span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    list: [],</span><br><span class="line">    services: [],</span><br><span class="line">    serviceId: <span class="number">0</span>,</span><br><span class="line">    writeCharacter: <span class="literal">false</span>,</span><br><span class="line">    readCharacter: <span class="literal">false</span>,</span><br><span class="line">    notifyCharacter: <span class="literal">false</span>,</span><br><span class="line">    isScanning:<span class="literal">false</span>,</span><br><span class="line">    aypiId:<span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//搜索设备</span></span><br><span class="line">  startSearch: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    wx.openBluetoothAdapter(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        wx.getBluetoothAdapterState(&#123;</span><br><span class="line">          success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;openBluetoothAdapter success&#x27;</span>, res)</span><br><span class="line">            <span class="keyword">if</span> (res.available) &#123;</span><br><span class="line">              <span class="keyword">if</span> (res.discovering) &#123;</span><br><span class="line">                wx.stopBluetoothDevicesDiscovery(&#123;</span><br><span class="line">                  success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(res)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// that.startBluetoothDevicesDiscovery()</span></span><br><span class="line">                that.getBluetoothDevices()</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">// that.checkPemission()</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              wx.showModal(&#123;</span><br><span class="line">                title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">                content: <span class="string">&#x27;本机蓝牙不可用&#x27;</span>,</span><br><span class="line">                showCancel: <span class="literal">false</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        wx.showModal(&#123;</span><br><span class="line">          title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">          content: <span class="string">&#x27;蓝牙初始化失败，请到设置打开蓝牙&#x27;</span>,</span><br><span class="line">          showCancel: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  checkPemission: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">//android 6.0以上需授权地理位置权限</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> platform = app.BLEInformation.platform</span><br><span class="line">    <span class="keyword">if</span> (platform == <span class="string">&quot;ios&quot;</span>) &#123;</span><br><span class="line">      app.globalData.platform = <span class="string">&quot;ios&quot;</span></span><br><span class="line">      that.getBluetoothDevices()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (platform == <span class="string">&quot;android&quot;</span>) &#123;</span><br><span class="line">      app.globalData.platform = <span class="string">&quot;android&quot;</span></span><br><span class="line">      <span class="built_in">console</span>.log(app.getSystem().substring(app.getSystem().length - (app.getSystem().length - <span class="number">8</span>), app.getSystem().length - (app.getSystem().length - <span class="number">8</span>) + <span class="number">1</span>))</span><br><span class="line">      <span class="keyword">if</span> (app.getSystem().substring(app.getSystem().length - (app.getSystem().length - <span class="number">8</span>), app.getSystem().length - (app.getSystem().length - <span class="number">8</span>) + <span class="number">1</span>) &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        wx.getSetting(&#123;</span><br><span class="line">          success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">            <span class="keyword">if</span> (!res.authSetting[<span class="string">&#x27;scope.userLocation&#x27;</span>]) &#123;</span><br><span class="line">              wx.authorize(&#123;</span><br><span class="line">                scope: <span class="string">&#x27;scope.userLocation&#x27;</span>,</span><br><span class="line">                complete: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                  that.getBluetoothDevices()</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              that.getBluetoothDevices()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getBluetoothDevices: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">//获取蓝牙设备信息</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;start search&quot;</span>)</span><br><span class="line">    wx.showLoading(&#123;</span><br><span class="line">      title: <span class="string">&#x27;正在加载&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&#x27;loading&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      isScanning:<span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    wx.startBluetoothDevicesDiscovery(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          wx.getBluetoothDevices(&#123;</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">var</span> devices = []</span><br><span class="line">              <span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; res.devices.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.devices[i].name != <span class="string">&quot;未知设备&quot;</span>) &#123;</span><br><span class="line">                  devices[num] = res.devices[i]</span><br><span class="line">                  num++</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              that.setData(&#123;</span><br><span class="line">                list: devices,</span><br><span class="line">                isScanning:<span class="literal">false</span></span><br><span class="line">              &#125;)</span><br><span class="line">              wx.hideLoading()</span><br><span class="line">              wx.stopPullDownRefresh()</span><br><span class="line">              wx.stopBluetoothDevicesDiscovery(&#123;</span><br><span class="line">                success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                  <span class="built_in">console</span>.log(<span class="string">&quot;停止搜索蓝牙&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;, <span class="number">5000</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindViewTap: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    wx.stopBluetoothDevicesDiscovery(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123; <span class="built_in">console</span>.log(res) &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      serviceId: <span class="number">0</span>,</span><br><span class="line">      writeCharacter: <span class="literal">false</span>,</span><br><span class="line">      readCharacter: <span class="literal">false</span>,</span><br><span class="line">      notifyCharacter: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(e.currentTarget.dataset.title)</span><br><span class="line">    wx.showLoading(&#123;</span><br><span class="line">      title: <span class="string">&#x27;正在连接&#x27;</span>,</span><br><span class="line">      </span><br><span class="line">    &#125;)</span><br><span class="line">    wx.createBLEConnection(&#123;</span><br><span class="line">      deviceId: e.currentTarget.dataset.title,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        app.BLEInformation.deviceId = e.currentTarget.dataset.title</span><br><span class="line">        that.getSeviceId()</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        wx.showModal(&#123;</span><br><span class="line">          title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">          content: <span class="string">&#x27;连接失败&#x27;</span>,</span><br><span class="line">          showCancel: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">        wx.hideLoading()</span><br><span class="line">      &#125;, <span class="attr">complete</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  getSeviceId: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> platform = app.BLEInformation.platform</span><br><span class="line">    <span class="built_in">console</span>.log(app.BLEInformation.deviceId)</span><br><span class="line">    wx.getBLEDeviceServices(&#123;</span><br><span class="line">      deviceId: app.BLEInformation.deviceId,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          services: res.services</span><br><span class="line">        &#125;)</span><br><span class="line">        that.getCharacteristics()</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;, <span class="attr">complete</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  getCharacteristics: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> list = that.data.services</span><br><span class="line">    <span class="keyword">var</span> num = that.data.serviceId</span><br><span class="line">    <span class="keyword">var</span> write = that.data.writeCharacter</span><br><span class="line">    <span class="keyword">var</span> read = that.data.readCharacter</span><br><span class="line">    <span class="keyword">var</span> notify = that.data.notifyCharacter</span><br><span class="line">    wx.getBLEDeviceCharacteristics(&#123;</span><br><span class="line">      deviceId: app.BLEInformation.deviceId,</span><br><span class="line">      serviceId: list[num].uuid,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; res.characteristics.length; ++i) &#123;</span><br><span class="line">          <span class="keyword">var</span> properties = res.characteristics[i].properties</span><br><span class="line">          <span class="keyword">var</span> item = res.characteristics[i].uuid</span><br><span class="line">          <span class="keyword">if</span> (!notify) &#123;</span><br><span class="line">            <span class="keyword">if</span> (properties.notify) &#123;</span><br><span class="line">              app.BLEInformation.notifyCharaterId = item</span><br><span class="line">              app.BLEInformation.notifyServiceId = list[num].uuid</span><br><span class="line">              notify = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!write) &#123;</span><br><span class="line">            <span class="keyword">if</span> (properties.write) &#123;</span><br><span class="line">              app.BLEInformation.writeCharaterId = item</span><br><span class="line">              app.BLEInformation.writeServiceId = list[num].uuid</span><br><span class="line">              write = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!read) &#123;</span><br><span class="line">            <span class="keyword">if</span> (properties.read) &#123;</span><br><span class="line">              app.BLEInformation.readCharaterId = item</span><br><span class="line">              app.BLEInformation.readServiceId = list[num].uuid</span><br><span class="line">              read = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!write || !notify || !read) &#123;</span><br><span class="line">          num++</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            writeCharacter: write,</span><br><span class="line">            readCharacter: read,</span><br><span class="line">            notifyCharacter: notify,</span><br><span class="line">            serviceId: num</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">if</span> (num == list.length) &#123;</span><br><span class="line">            wx.showModal(&#123;</span><br><span class="line">              title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">              content: <span class="string">&#x27;找不到该读写的特征值&#x27;</span>,</span><br><span class="line">              showCancel: <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            that.getCharacteristics()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          wx.showToast(&#123;</span><br><span class="line">            title: <span class="string">&#x27;连接成功&#x27;</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">          that.openControl()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">      &#125;, <span class="attr">complete</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;write:&quot;</span> + app.BLEInformation.writeCharaterId)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;read:&quot;</span> + app.BLEInformation.readCharaterId)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;notify:&quot;</span> + app.BLEInformation.notifyCharaterId)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">   openControl: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">//连接成功返回主页</span></span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">&#x27;/pages/pack/previewPrint/previewPrint?aypId=&#x27;</span>+that.data.aypiId,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    that.setData(&#123;<span class="attr">aypiId</span>:options.aypiId&#125;)</span><br><span class="line">    app.BLEInformation.platform = app.getPlatform()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面初次渲染完成</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面显示</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面隐藏</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onHide: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面卸载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onUnload: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面上拉触底事件的处理函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReachBottom: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用户点击右上角分享</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShareAppMessage: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>2.打印（蓝牙连接成功后跳转到打印页面）</p><p>该打印功能直接写在js代码中，无预览功能，只能通过精确计算得出具体的位置，所以预览功能要单独再页面中写出来，项目打印中有条形码，条形码是在一个canvans画板中画出来的，所以当打印的东西也写在画板中时（原来的思路），就会有两个画板，这样二者无法融合，所以通过另外一种方法实现。打印需求是可以自己选择要打印的内容，可以通过勾选框实现，然后遍历checked是true的几项，就是勾选的要打印的。</p><p>注意：该项目有用到两个相关的文件util和tsc，tsc中提供了打印内容调用的方法，util主要是barCode的使用，两个文件可以在以下地址查看</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/pack/previewPrint/previewPrint.js</span></span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;../../../utils/util&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"><span class="keyword">const</span> tsc = <span class="built_in">require</span>(<span class="string">&#x27;../../../utils/tsc.js&#x27;</span>)</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;../../../utils/moment.min.js&#x27;</span></span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    blueToothConnect: <span class="literal">false</span>, <span class="comment">//蓝牙连接是否可用</span></span><br><span class="line">    aypId: <span class="number">1</span>,<span class="comment">//包装表ID</span></span><br><span class="line">    list: [],</span><br><span class="line">    printDate: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    allChecked:<span class="literal">true</span>,</span><br><span class="line">    canvasWidth: <span class="number">347</span>,</span><br><span class="line">    canvasHeight: <span class="number">326</span>,</span><br><span class="line">    oneTimeData: <span class="number">120</span>,</span><br><span class="line">    currentTime: <span class="number">1</span>,</span><br><span class="line">    looptime: <span class="number">0</span>,</span><br><span class="line">    currentPrint: <span class="number">1</span>,</span><br><span class="line">    lastData: <span class="number">0</span>,</span><br><span class="line">    printerNum: <span class="number">1</span>,</span><br><span class="line">    BLEInformation: app.BLEInformation</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//code转化为条形码</span></span><br><span class="line">  <span class="function"><span class="title">handleCreateBarCode</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.data.list.length &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.data.list.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        util.barcode(item.barCode, item.barCode, <span class="number">622</span>, <span class="number">180</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//动态获取要打印的数据内容</span></span><br><span class="line">  <span class="function"><span class="title">getList</span>(<span class="params">callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: getApp().baseUrl + <span class="string">&#x27;/iext/back/applets/PackageController/searchPackageInfo&#x27;</span>,</span><br><span class="line">      method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      header: &#123;</span><br><span class="line">        Cookie: wx.getStorageSync(<span class="string">&#x27;sessionid&#x27;</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        aypId: that.data.aypId</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.data.success === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> date = moment(<span class="keyword">new</span> <span class="built_in">Date</span>()).format(<span class="string">&#x27;YYYY-MM-DD  HH:mm&#x27;</span>)</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; res.data.body.weightList.length; i++) &#123;</span><br><span class="line">            res.data.body.weightList[i].checked = <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            list: res.data.body.weightList,</span><br><span class="line">            printDate: date</span><br><span class="line">          &#125;)</span><br><span class="line">          callback()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(res.data.msg)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">fail</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.data.msg)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 勾选复选框</span></span><br><span class="line">  <span class="function"><span class="title">onChangeCheck</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">const</span> newList = that.data.list</span><br><span class="line">    newList[e.currentTarget.dataset.index].checked = !newList[e.currentTarget.dataset.index].checked</span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      list: newList</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; that.data.list.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span>(that.data.list[i].checked===<span class="literal">false</span>)&#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          allChecked: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> result=that.data.list.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.checked===<span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span>(result.length===<span class="number">0</span>)&#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          allChecked: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 全选复选框</span></span><br><span class="line">  <span class="function"><span class="title">onChangeAllCheck</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      allChecked:!that.data.allChecked</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(that.data.allChecked)&#123;</span><br><span class="line">      <span class="keyword">const</span> newList=that.data.list</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newList.length; i++) &#123;</span><br><span class="line">        newList[i].checked=<span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        list:newList</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> newList=that.data.list</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newList.length; i++) &#123;</span><br><span class="line">        newList[i].checked=<span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        list:newList</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//页面中点击打印调用此方法</span></span><br><span class="line">  printPhoto: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">//打印bitmap，图片内容不建议太大，小程序限制传输的字节数为20byte</span></span><br><span class="line">   <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">    <span class="comment">//查看蓝牙连接是否可用</span></span><br><span class="line">    <span class="keyword">if</span> (that.data.blueToothConnect === <span class="literal">false</span>) &#123;</span><br><span class="line">      wx.navigateTo(&#123;</span><br><span class="line">        url: <span class="string">&#x27;../bleConnect/bleConnect?aypiId=&#x27;</span> + that.data.list[<span class="number">0</span>].aypiId</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; that.data.list.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> list = that.data.list[i]</span><br><span class="line">        <span class="keyword">if</span> (list.checked === <span class="literal">false</span>) &#123;</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            that.realPrint(list)</span><br><span class="line">          &#125;, <span class="number">5000</span> * i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//构建打印的内容和样式</span></span><br><span class="line">  realPrint:<span class="function"><span class="keyword">function</span>(<span class="params">list</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that=<span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> command = tsc.jpPrinter.createNew()</span><br><span class="line">    command.setCls()<span class="comment">//清除缓冲区，防止下一个没生效</span></span><br><span class="line">    command.setSize(<span class="number">70</span>, <span class="number">60</span>)<span class="comment">//设置标签大小，单位mm.具体参数请用尺子量一下</span></span><br><span class="line">    command.setGap(<span class="number">0</span>)<span class="comment">//设置两个标签之间的间隙，单位mm.具体参数请用尺子量一下</span></span><br><span class="line">    command.setCls()<span class="comment">//清除缓冲区</span></span><br><span class="line">    command.setBar(<span class="number">10</span>, <span class="number">75</span>, <span class="number">500</span>, <span class="number">3</span>);<span class="comment">//绘制一条黑线</span></span><br><span class="line">    command.setText(<span class="number">105</span>, <span class="number">20</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="string">&quot;包装流转信息卡&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;订单单号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">140</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.orderNumber)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">340</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;箱    号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">450</span>, <span class="number">100</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.aypAyciNum)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;工单单号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">140</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.workOrderNumber)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">340</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;机 台 号：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">450</span>, <span class="number">150</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.deviceNumber)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">200</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;规    格：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    <span class="keyword">const</span> str = list.standards</span><br><span class="line">    <span class="keyword">if</span> (str.length &gt; <span class="number">25</span>) &#123;</span><br><span class="line">      command.setText(<span class="number">140</span>, <span class="number">200</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, str.slice(<span class="number">0</span>, <span class="number">26</span>))<span class="comment">//绘制文字</span></span><br><span class="line">      command.setText(<span class="number">140</span>, <span class="number">240</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, str.slice(<span class="number">26</span>, str.length))<span class="comment">//绘制文字</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      command.setText(<span class="number">140</span>, <span class="number">200</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, str)<span class="comment">//绘制文字</span></span><br><span class="line">    &#125;</span><br><span class="line">    command.setText(<span class="number">30</span>, <span class="number">280</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;净    重：&quot;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">140</span>, <span class="number">280</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.netWeight + <span class="string">&#x27;kg&#x27;</span>)<span class="comment">//绘制文字</span></span><br><span class="line">    command.setText(<span class="number">300</span>, <span class="number">280</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, that.data.printDate)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setBarCode(<span class="number">30</span>, <span class="number">330</span>, <span class="string">&quot;128&quot;</span>, <span class="number">110</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">3</span>, list.barCode)<span class="comment">//绘制code128条码</span></span><br><span class="line">    command.setText(<span class="number">150</span>, <span class="number">440</span>, <span class="string">&quot;TSS24.BF2&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, list.barCode)<span class="comment">//绘制文字</span></span><br><span class="line"></span><br><span class="line">    command.setPagePrint()<span class="comment">//执行打印指令</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      isLabelSend: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    that.prepareSend(command.getData())</span><br><span class="line">  &#125;,</span><br><span class="line">  prepareSend: <span class="function"><span class="keyword">function</span> (<span class="params">buff</span>) </span>&#123; <span class="comment">//准备发送，根据每次发送字节数来处理分包数量</span></span><br><span class="line">    <span class="comment">//console.log(buff)</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> time = that.data.oneTimeData</span><br><span class="line">    <span class="keyword">var</span> looptime = <span class="built_in">parseInt</span>(buff.length / time);</span><br><span class="line">    <span class="keyword">var</span> lastData = <span class="built_in">parseInt</span>(buff.length % time);</span><br><span class="line">    <span class="comment">//console.log(looptime + &quot;---&quot; + lastData)</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      looptime: looptime + <span class="number">1</span>,</span><br><span class="line">      lastData: lastData,</span><br><span class="line">      currentTime: <span class="number">1</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(buff)</span><br><span class="line">    that.Send(buff)</span><br><span class="line">  &#125;,</span><br><span class="line">  Send: <span class="function"><span class="keyword">function</span> (<span class="params">buff</span>) </span>&#123; <span class="comment">//分包发送</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">var</span> currentTime = that.data.currentTime</span><br><span class="line">    <span class="keyword">var</span> loopTime = that.data.looptime</span><br><span class="line">    <span class="keyword">var</span> lastData = that.data.lastData</span><br><span class="line">    <span class="keyword">var</span> onTimeData = that.data.oneTimeData</span><br><span class="line">    <span class="keyword">var</span> printNum = that.data.printerNum</span><br><span class="line">    <span class="keyword">var</span> currentPrint = that.data.currentPrint</span><br><span class="line">    <span class="keyword">var</span> buf</span><br><span class="line">    <span class="keyword">var</span> dataView</span><br><span class="line">    <span class="keyword">if</span> (currentTime &lt; loopTime) &#123;</span><br><span class="line">      buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(onTimeData)</span><br><span class="line">      dataView = <span class="keyword">new</span> <span class="built_in">DataView</span>(buf)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; onTimeData; ++i) &#123;</span><br><span class="line">        dataView.setUint8(i, buff[(currentTime - <span class="number">1</span>) * onTimeData + i])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(lastData)</span><br><span class="line">      dataView = <span class="keyword">new</span> <span class="built_in">DataView</span>(buf)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; lastData; ++i) &#123;</span><br><span class="line">        dataView.setUint8(i, buff[(currentTime - <span class="number">1</span>) * onTimeData + i])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//console.log(&quot;第&quot; + currentTime + &quot;次发送数据大小为：&quot; + buf.byteLength)</span></span><br><span class="line">    wx.writeBLECharacteristicValue(&#123;</span><br><span class="line">      deviceId: app.BLEInformation.deviceId,</span><br><span class="line">      serviceId: app.BLEInformation.writeServiceId,</span><br><span class="line">      characteristicId: app.BLEInformation.writeCharaterId,</span><br><span class="line">      value: buf,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentPrint == printNum) &#123;</span><br><span class="line">          wx.showToast(&#123;</span><br><span class="line">            title: <span class="string">&#x27;已打印第&#x27;</span> + currentPrint + <span class="string">&#x27;张成功&#x27;</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//console.log(res)</span></span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          title: <span class="string">&#x27;打印第&#x27;</span> + currentPrint + <span class="string">&#x27;张失败&#x27;</span>,</span><br><span class="line">          icon: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//console.log(e)</span></span><br><span class="line">      &#125;,</span><br><span class="line">      complete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        currentTime++</span><br><span class="line">        <span class="keyword">if</span> (currentTime &lt;= loopTime) &#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            currentTime: currentTime</span><br><span class="line">          &#125;)</span><br><span class="line">          that.Send(buff)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// wx.showToast(&#123;</span></span><br><span class="line">          <span class="comment">//   title: &#x27;已打印第&#x27; + currentPrint + &#x27;张&#x27;,</span></span><br><span class="line">          <span class="comment">// &#125;)`</span></span><br><span class="line">          <span class="keyword">if</span> (currentPrint == printNum) &#123;</span><br><span class="line">            that.setData(&#123;</span><br><span class="line">              looptime: <span class="number">0</span>,</span><br><span class="line">              lastData: <span class="number">0</span>,</span><br><span class="line">              currentTime: <span class="number">1</span>,</span><br><span class="line">              isLabelSend: <span class="literal">false</span>,</span><br><span class="line">              currentPrint: <span class="number">1</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            currentPrint++</span><br><span class="line">            that.setData(&#123;</span><br><span class="line">              currentPrint: currentPrint,</span><br><span class="line">              currentTime: <span class="number">1</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">            that.Send(buff)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      aypId: options.aypId</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面初次渲染完成</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">const</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="comment">// 获取蓝牙设备状态是否可用</span></span><br><span class="line">    wx.getBluetoothAdapterState(&#123;</span><br><span class="line">      <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.available === <span class="literal">true</span>) &#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">false</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="function"><span class="title">fail</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err.errCode!==<span class="number">0</span>&amp;&amp;err.errCode!==-<span class="number">1</span>)&#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">false</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            blueToothConnect: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 监听蓝牙设备状态是否可用</span></span><br><span class="line">    wx.onBluetoothAdapterStateChange(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (res.available === <span class="literal">true</span>) &#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          blueToothConnect: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          blueToothConnect: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面显示</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.getList(<span class="built_in">this</span>.handleCreateBarCode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获得上一个页面中的路由</span><br><span class="line">   var that &#x3D; this;</span><br><span class="line">   let pages &#x3D; getCurrentPages();</span><br><span class="line">   let currPage &#x3D; null;</span><br><span class="line">   if (pages.length) &#123;</span><br><span class="line">     currPage &#x3D; pages[pages.length - 2];</span><br><span class="line">   &#125;</span><br><span class="line">   let route &#x3D; currPage.route</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;小程序打印的示例&quot;&gt;&lt;a href=&quot;#小程序打印的示例&quot; class=&quot;headerlink&quot; title=&quot;小程序打印的示例&quot;&gt;&lt;/a&gt;小程序打印的示例&lt;/h3&gt;&lt;p&gt;需求是小程序通过蓝牙连接打印所需要的的东西，具体实现主要包括两步：&lt;/p&gt;
&lt;p&gt;1.蓝牙连</summary>
      
    
    
    
    <category term="小程序" scheme="http://example.com/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2021/01/01/hello-world/"/>
    <id>http://example.com/2021/01/01/hello-world/</id>
    <published>2021-01-01T11:05:19.264Z</published>
    <updated>2021-01-01T11:05:19.264Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
